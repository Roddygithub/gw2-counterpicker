<!-- Real dps.report Analysis Result -->
<style>
/* ArcDPS Profession Colors */
.prof-guardian { color: #72C1D9; background-color: rgba(114, 193, 217, 0.15); }
.prof-dragonhunter { color: #72C1D9; background-color: rgba(114, 193, 217, 0.15); }
.prof-firebrand { color: #72C1D9; background-color: rgba(114, 193, 217, 0.15); }
.prof-willbender { color: #72C1D9; background-color: rgba(114, 193, 217, 0.15); }
.prof-luminary { color: #72C1D9; background-color: rgba(114, 193, 217, 0.15); }
.prof-troubadour { color: #72C1D9; background-color: rgba(114, 193, 217, 0.15); }

.prof-warrior { color: #FFD166; background-color: rgba(255, 209, 102, 0.15); }
.prof-berserker { color: #FFD166; background-color: rgba(255, 209, 102, 0.15); }
.prof-spellbreaker { color: #FFD166; background-color: rgba(255, 209, 102, 0.15); }
.prof-bladesworn { color: #FFD166; background-color: rgba(255, 209, 102, 0.15); }

.prof-engineer { color: #D09C59; background-color: rgba(208, 156, 89, 0.15); }
.prof-scrapper { color: #D09C59; background-color: rgba(208, 156, 89, 0.15); }
.prof-holosmith { color: #D09C59; background-color: rgba(208, 156, 89, 0.15); }
.prof-mechanist { color: #D09C59; background-color: rgba(208, 156, 89, 0.15); }

.prof-ranger { color: #8CDC82; background-color: rgba(140, 220, 130, 0.15); }
.prof-druid { color: #8CDC82; background-color: rgba(140, 220, 130, 0.15); }
.prof-soulbeast { color: #8CDC82; background-color: rgba(140, 220, 130, 0.15); }
.prof-untamed { color: #8CDC82; background-color: rgba(140, 220, 130, 0.15); }

.prof-thief { color: #C08F95; background-color: rgba(192, 143, 149, 0.15); }
.prof-daredevil { color: #C08F95; background-color: rgba(192, 143, 149, 0.15); }
.prof-deadeye { color: #C08F95; background-color: rgba(192, 143, 149, 0.15); }
.prof-specter { color: #C08F95; background-color: rgba(192, 143, 149, 0.15); }

.prof-elementalist { color: #F68A87; background-color: rgba(246, 138, 135, 0.15); }
.prof-tempest { color: #F68A87; background-color: rgba(246, 138, 135, 0.15); }
.prof-weaver { color: #F68A87; background-color: rgba(246, 138, 135, 0.15); }
.prof-catalyst { color: #F68A87; background-color: rgba(246, 138, 135, 0.15); }
.prof-evoker { color: #F68A87; background-color: rgba(246, 138, 135, 0.15); }

.prof-mesmer { color: #B679D5; background-color: rgba(182, 121, 213, 0.15); }
.prof-chronomancer { color: #B679D5; background-color: rgba(182, 121, 213, 0.15); }
.prof-mirage { color: #B679D5; background-color: rgba(182, 121, 213, 0.15); }
.prof-virtuoso { color: #B679D5; background-color: rgba(182, 121, 213, 0.15); }

.prof-necromancer { color: #52A76F; background-color: rgba(82, 167, 111, 0.15); }
.prof-reaper { color: #52A76F; background-color: rgba(82, 167, 111, 0.15); }
.prof-scourge { color: #52A76F; background-color: rgba(82, 167, 111, 0.15); }
.prof-harbinger { color: #52A76F; background-color: rgba(82, 167, 111, 0.15); }

.prof-revenant { color: #D16E5A; background-color: rgba(209, 110, 90, 0.15); }
.prof-herald { color: #D16E5A; background-color: rgba(209, 110, 90, 0.15); }
.prof-renegade { color: #D16E5A; background-color: rgba(209, 110, 90, 0.15); }
.prof-vindicator { color: #D16E5A; background-color: rgba(209, 110, 90, 0.15); }

/* JW specs */
.prof-paragon { color: #D16E5A; background-color: rgba(209, 110, 90, 0.15); }
.prof-ritualist { color: #52A76F; background-color: rgba(82, 167, 111, 0.15); }
.prof-conduit { color: #F68A87; background-color: rgba(246, 138, 135, 0.15); }
.prof-amalgam { color: #D09C59; background-color: rgba(208, 156, 89, 0.15); }

.prof-unknown { color: #888888; background-color: rgba(136, 136, 136, 0.15); }

.sort-controls button {
    font-weight: 600;
}
.sort-controls button.active {
    border-color: #ffffff;
    color: #ffffff;
}
</style>
<div class="space-y-6 animate-slide-up">
    <!-- Success Header -->
    <div class="glow-card rounded-2xl p-6 border-2 border-green-500/50">
        <div class="flex items-center gap-4 mb-4">
            <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-green-500 to-emerald-500 flex items-center justify-center">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
            <div>
                <h2 class="font-display text-2xl font-bold text-white flex items-center gap-2">
                    üéØ Analyse R√©elle via dps.report
                    <span class="px-2 py-1 rounded-full text-xs bg-green-500/20 text-green-400 border border-green-500/30">
                        ‚úì Donn√©es R√©elles
                    </span>
                </h2>
                <p class="text-gray-400">
                    {{ filename }} ‚Ä¢ Analys√© √† {{ timestamp }}
                </p>
            </div>
        </div>
        
        <!-- Fight Info -->
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
            <div class="bg-gw2-darker rounded-xl p-3 text-center">
                <div class="text-xl font-display font-bold text-gw2-purple">{{ players.fight_name }}</div>
                <div class="text-xs text-gray-400">Combat</div>
            </div>
            <div class="bg-gw2-darker rounded-xl p-3 text-center">
                <div class="text-xl font-display font-bold text-white">{{ players.duration_sec|default(0) }}s</div>
                <div class="text-xs text-gray-400">Dur√©e</div>
            </div>
            <div class="bg-gw2-darker rounded-xl p-3 text-center">
                <div class="text-xl font-display font-bold text-cyber-pink">{{ players.allies|length }}</div>
                <div class="text-xs text-gray-400">Alli√©s</div>
            </div>
            <div class="bg-gw2-darker rounded-xl p-3 text-center">
                <div class="text-xl font-display font-bold text-red-400">{{ players.enemies|length }}</div>
                <div class="text-xs text-gray-400">Ennemis d√©tect√©s</div>
            </div>
            <div class="bg-gw2-darker rounded-xl p-3 text-center">
                <a href="{{ permalink }}" target="_blank" class="text-xl font-display font-bold text-cyber-cyan hover:underline">
                    Voir sur dps.report ‚Üí
                </a>
                <div class="text-xs text-gray-400">Lien complet</div>
            </div>
        </div>
    </div>
    
    <!-- Squad Composition Summary -->
    {% if players.composition %}
    <div class="glow-card rounded-2xl p-6">
        <h3 class="font-display text-xl font-bold text-green-400 mb-4">üìä R√©sum√© de Composition</h3>
        
        <!-- Role Distribution -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-gw2-darker rounded-xl p-4 text-center border border-orange-500/30">
                <div class="text-3xl font-bold text-orange-400">{{ players.composition.role_counts.dps }}</div>
                <div class="text-sm text-gray-400">‚öîÔ∏è DPS</div>
            </div>
            <div class="bg-gw2-darker rounded-xl p-4 text-center border border-yellow-500/30">
                <div class="text-3xl font-bold text-yellow-400">{{ players.composition.role_counts.stab }}</div>
                <div class="text-sm text-gray-400">üõ°Ô∏è Stab</div>
            </div>
            <div class="bg-gw2-darker rounded-xl p-4 text-center border border-green-500/30">
                <div class="text-3xl font-bold text-green-400">{{ players.composition.role_counts.healer }}</div>
                <div class="text-sm text-gray-400">üíö Healers</div>
            </div>
            <div class="bg-gw2-darker rounded-xl p-4 text-center border border-cyan-500/30">
                <div class="text-3xl font-bold text-cyan-400">{{ players.composition.role_counts.boon }}</div>
                <div class="text-sm text-gray-400">‚ú® Boons</div>
            </div>
        </div>
        
        <!-- Spec Breakdown -->
        <div class="flex flex-wrap gap-2">
            {% for spec, count in players.composition.spec_counts.items() %}
            <span class="px-3 py-1 rounded-lg text-sm prof-{{ spec|lower|replace(' ', '') }} border border-gray-700">
                {{ spec }}: <strong>{{ count }}</strong>
            </span>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <!-- Allied Players -->
    {% if players.allies %}
    <div class="glow-card rounded-2xl p-6">
        <div class="sort-controls flex flex-wrap gap-2 justify-end mb-4 text-xs text-gray-300">
            <span class="uppercase tracking-wide text-gray-500 mr-auto">Tri</span>
            <button type="button" class="sort-btn px-3 py-1 rounded-lg bg-gw2-darker border border-gray-700 hover:border-white transition-all"
                    data-sort-target="allies-table" data-sort-mode="default">
                Par d√©faut
            </button>
            <button type="button" class="sort-btn px-3 py-1 rounded-lg bg-gw2-darker border border-gray-700 hover:border-white transition-all"
                    data-sort-target="allies-table" data-sort-mode="profession">
                Par classe
            </button>
            <button type="button" class="sort-btn px-3 py-1 rounded-lg bg-gw2-darker border border-gray-700 hover:border-white transition-all"
                    data-sort-target="allies-table" data-sort-mode="group">
                Par sous-groupe
            </button>
        </div>
        <h3 class="font-display text-xl font-bold text-green-400 mb-4 flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
            üõ°Ô∏è Ton Escouade ({{ players.allies|length }} joueurs)
        </h3>
        
        <div class="overflow-x-auto">
            <table class="w-full text-sm sortable-table" id="allies-table">
                <thead>
                    <tr class="text-left text-gray-400 border-b border-gray-700">
                        <th class="pb-2">Joueur</th>
                        <th class="pb-2">Classe</th>
                        <th class="pb-2">R√¥le</th>
                        <th class="pb-2">Groupe</th>
                        <th class="pb-2 text-right">D√©g√¢ts</th>
                        <th class="pb-2 text-right">C/s</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-800">
                    {% for player in players.allies %}
                    <tr class="hover:bg-gw2-darker/50"
                        data-profession="{{ player.profession|lower }}"
                        data-group="{{ player.group }}"
                        data-damage="{{ player.damage }}"
                        data-original-order="{{ loop.index0 }}">
                        <td class="py-2">
                            <div class="flex items-center gap-2">
                                {% if player.is_commander %}
                                <span class="text-yellow-400">üëë</span>
                                {% endif %}
                                <span class="font-medium text-white">{{ player.name }}</span>
                                <span class="text-xs text-gray-500">{{ player.account }}</span>
                            </div>
                        </td>
                        <td class="py-2">
                            <span class="px-2 py-1 rounded text-xs prof-{{ player.profession|lower|replace(' ', '') }}">
                                {{ player.profession }}
                            </span>
                        </td>
                        <td class="py-2">
                            {% if player.role == 'healer' %}
                            <span class="px-2 py-1 rounded text-xs bg-green-500/20 text-green-400 border border-green-500/30">üíö Heal</span>
                            {% elif player.role == 'stab' %}
                            <span class="px-2 py-1 rounded text-xs bg-yellow-500/20 text-yellow-400 border border-yellow-500/30">üõ°Ô∏è Stab</span>
                            {% elif player.role == 'boon' %}
                            <span class="px-2 py-1 rounded text-xs bg-cyan-500/20 text-cyan-400 border border-cyan-500/30">‚ú® Boon</span>
                            {% else %}
                            <span class="px-2 py-1 rounded text-xs bg-orange-500/20 text-orange-400 border border-orange-500/30">‚öîÔ∏è DPS</span>
                            {% endif %}
                        </td>
                        <td class="py-2 text-gray-400">{{ player.group }}</td>
                        <td class="py-2 text-right font-mono text-orange-400">
                            {{ "{:,}".format(player.damage) }}
                        </td>
                        <td class="py-2 text-right font-mono text-cyan-400">
                            {{ player.cleanses_per_sec|default(0) }}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}
    
    <!-- Enemy Players (if WvW) -->
    {% if players.enemies %}
    <div class="glow-card rounded-2xl p-6">
        <div class="sort-controls flex flex-wrap gap-2 justify-end mb-4 text-xs text-gray-300">
            <span class="uppercase tracking-wide text-gray-500 mr-auto">Tri</span>
            <button type="button" class="sort-btn px-3 py-1 rounded-lg bg-gw2-darker border border-gray-700 hover:border-white transition-all"
                    data-sort-target="enemies-table" data-sort-mode="default">
                Par d√©faut
            </button>
            <button type="button" class="sort-btn px-3 py-1 rounded-lg bg-gw2-darker border border-gray-700 hover:border-white transition-all"
                    data-sort-target="enemies-table" data-sort-mode="profession">
                Par classe
            </button>
            <button type="button" class="sort-btn px-3 py-1 rounded-lg bg-gw2-darker border border-gray-700 hover:border-white transition-all"
                    data-sort-target="enemies-table" data-sort-mode="damage">
                Par d√©g√¢ts subis
            </button>
        </div>
        <h3 class="font-display text-xl font-bold text-red-400 mb-4 flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
            </svg>
            ‚öîÔ∏è Escouade Adverse ({{ players.enemies|length }} joueurs d√©tect√©s)
        </h3>

        <div class="overflow-x-auto">
            <table class="w-full text-sm sortable-table" id="enemies-table">
                <thead>
                    <tr class="text-left text-gray-400 border-b border-gray-700">
                        <th class="pb-2">Joueur</th>
                        <th class="pb-2">Classe</th>
                        <th class="pb-2 text-right">D√©g√¢ts subis</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-800">
                    {% for enemy in players.enemies %}
                    <tr class="hover:bg-gw2-darker/50"
                        data-profession="{{ enemy.profession|lower }}"
                        data-group="0"
                        data-damage="{{ enemy.damage_taken }}"
                        data-original-order="{{ loop.index0 }}">
                        <td class="py-2">
                            <span class="font-medium text-white">{{ enemy.name }}</span>
                        </td>
                        <td class="py-2">
                            <span class="px-2 py-1 rounded text-xs prof-{{ enemy.profession|lower|replace(' ', '') }}">
                                {{ enemy.profession }}
                            </span>
                        </td>
                        <td class="py-2 text-right font-mono text-red-300">
                            {{ "{:,}".format(enemy.damage_taken) }}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}
    
    <!-- Counter Composition Suggestion -->
    {% if counter %}
    <div class="glow-card rounded-2xl p-6 border-2 border-gw2-purple/50">
        <h3 class="font-display text-xl font-bold text-gw2-purple mb-4 flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
            </svg>
            üéØ Composition Counter Recommand√©e
        </h3>
        
        <p class="text-gray-400 mb-4">
            Bas√©e sur l'analyse de {{ players.enemies|length }} ennemis d√©tect√©s
        </p>
        
        <!-- Recommended Builds -->
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-3 mb-6">
            {% for build in counter.recommended_builds[:9] %}
            <div class="bg-gw2-darker rounded-xl p-3 border border-gw2-purple/20 hover:border-gw2-purple/50 transition-all">
                <div class="flex items-center gap-2 mb-1">
                    <span class="font-display font-bold text-white">{{ build.elite_spec }}</span>
                    <span class="px-2 py-0.5 rounded text-xs bg-gw2-purple/20 text-gw2-purple">
                        {{ build.role }}
                    </span>
                </div>
                <div class="text-xs text-gray-400">{{ build.reason }}</div>
            </div>
            {% endfor %}
        </div>
        
        <!-- Strategy -->
        {% if counter.strategy %}
        <div class="bg-gw2-darker rounded-xl p-4 mb-4">
            <h4 class="font-display font-bold text-cyber-cyan mb-2">üìã Strat√©gie</h4>
            <p class="text-gray-300 text-sm">{{ counter.strategy }}</p>
        </div>
        {% endif %}
        
        <!-- Key Targets -->
        {% if counter.key_targets %}
        <div class="bg-gw2-darker rounded-xl p-4">
            <h4 class="font-display font-bold text-red-400 mb-2">üéØ Cibles Prioritaires</h4>
            <div class="flex flex-wrap gap-2">
                {% for target in counter.key_targets %}
                <span class="px-3 py-1 rounded-full text-sm bg-red-500/20 text-red-300 border border-red-500/30">
                    {{ target }}
                </span>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
    {% endif %}
    
    <!-- Link to full report -->
    <div class="text-center">
        <a href="{{ permalink }}" target="_blank" 
           class="inline-flex items-center gap-2 px-6 py-3 rounded-xl bg-gradient-to-r from-gw2-purple to-cyber-pink hover:from-cyber-pink hover:to-gw2-purple transition-all font-display font-bold">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
            </svg>
            Voir le rapport complet sur dps.report
        </a>
        <p class="mt-2 text-sm text-gray-500">
            Analyse compl√®te avec graphiques, rotations et statistiques d√©taill√©es
        </p>
    </div>
</div>

<script>
document.addEventListener('htmx:afterSwap', initSortingControls);
document.addEventListener('DOMContentLoaded', initSortingControls);

function initSortingControls() {
    document.querySelectorAll('.sort-controls button').forEach(btn => {
        btn.removeEventListener('click', handleSortClick);
        btn.addEventListener('click', handleSortClick);
    });
}

function handleSortClick(event) {
    const btn = event.currentTarget;
    const tableId = btn.dataset.sortTarget;
    const mode = btn.dataset.sortMode;
    const table = document.getElementById(tableId);
    if (!table) return;

    btn.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');

    const rows = Array.from(table.querySelectorAll('tbody tr'));
    if (mode === 'default') {
        rows.sort((a, b) => Number(a.dataset.originalOrder) - Number(b.dataset.originalOrder));
    } else if (mode === 'profession') {
        rows.sort((a, b) => a.dataset.profession.localeCompare(b.dataset.profession));
    } else if (mode === 'group') {
        rows.sort((a, b) => Number(a.dataset.group) - Number(b.dataset.group));
    } else if (mode === 'damage') {
        rows.sort((a, b) => Number(b.dataset.damage) - Number(a.dataset.damage));
    }

    const tbody = table.querySelector('tbody');
    rows.forEach(row => tbody.appendChild(row));
}
</script>
