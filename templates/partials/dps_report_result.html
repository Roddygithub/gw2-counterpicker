<!-- Real dps.report Analysis Result -->
<style>
/* ArcDPS Profession Colors */
.prof-guardian { color: #72C1D9; background-color: rgba(114, 193, 217, 0.15); }
.prof-dragonhunter { color: #72C1D9; background-color: rgba(114, 193, 217, 0.15); }
.prof-firebrand { color: #72C1D9; background-color: rgba(114, 193, 217, 0.15); }
.prof-willbender { color: #72C1D9; background-color: rgba(114, 193, 217, 0.15); }
.prof-luminary { color: #72C1D9; background-color: rgba(114, 193, 217, 0.15); }
.prof-troubadour { color: #72C1D9; background-color: rgba(114, 193, 217, 0.15); }

.prof-warrior { color: #FFD166; background-color: rgba(255, 209, 102, 0.15); }
.prof-berserker { color: #FFD166; background-color: rgba(255, 209, 102, 0.15); }
.prof-spellbreaker { color: #FFD166; background-color: rgba(255, 209, 102, 0.15); }
.prof-bladesworn { color: #FFD166; background-color: rgba(255, 209, 102, 0.15); }

.prof-engineer { color: #D09C59; background-color: rgba(208, 156, 89, 0.15); }
.prof-scrapper { color: #D09C59; background-color: rgba(208, 156, 89, 0.15); }
.prof-holosmith { color: #D09C59; background-color: rgba(208, 156, 89, 0.15); }
.prof-mechanist { color: #D09C59; background-color: rgba(208, 156, 89, 0.15); }

.prof-ranger { color: #8CDC82; background-color: rgba(140, 220, 130, 0.15); }
.prof-druid { color: #8CDC82; background-color: rgba(140, 220, 130, 0.15); }
.prof-soulbeast { color: #8CDC82; background-color: rgba(140, 220, 130, 0.15); }
.prof-untamed { color: #8CDC82; background-color: rgba(140, 220, 130, 0.15); }

.prof-thief { color: #C08F95; background-color: rgba(192, 143, 149, 0.15); }
.prof-daredevil { color: #C08F95; background-color: rgba(192, 143, 149, 0.15); }
.prof-deadeye { color: #C08F95; background-color: rgba(192, 143, 149, 0.15); }
.prof-specter { color: #C08F95; background-color: rgba(192, 143, 149, 0.15); }

.prof-elementalist { color: #F68A87; background-color: rgba(246, 138, 135, 0.15); }
.prof-tempest { color: #F68A87; background-color: rgba(246, 138, 135, 0.15); }
.prof-weaver { color: #F68A87; background-color: rgba(246, 138, 135, 0.15); }
.prof-catalyst { color: #F68A87; background-color: rgba(246, 138, 135, 0.15); }
.prof-evoker { color: #F68A87; background-color: rgba(246, 138, 135, 0.15); }

.prof-mesmer { color: #B679D5; background-color: rgba(182, 121, 213, 0.15); }
.prof-chronomancer { color: #B679D5; background-color: rgba(182, 121, 213, 0.15); }
.prof-mirage { color: #B679D5; background-color: rgba(182, 121, 213, 0.15); }
.prof-virtuoso { color: #B679D5; background-color: rgba(182, 121, 213, 0.15); }

.prof-necromancer { color: #52A76F; background-color: rgba(82, 167, 111, 0.15); }
.prof-reaper { color: #52A76F; background-color: rgba(82, 167, 111, 0.15); }
.prof-scourge { color: #52A76F; background-color: rgba(82, 167, 111, 0.15); }
.prof-harbinger { color: #52A76F; background-color: rgba(82, 167, 111, 0.15); }

.prof-revenant { color: #D16E5A; background-color: rgba(209, 110, 90, 0.15); }
.prof-herald { color: #D16E5A; background-color: rgba(209, 110, 90, 0.15); }
.prof-renegade { color: #D16E5A; background-color: rgba(209, 110, 90, 0.15); }
.prof-vindicator { color: #D16E5A; background-color: rgba(209, 110, 90, 0.15); }

/* JW specs */
.prof-paragon { color: #D16E5A; background-color: rgba(209, 110, 90, 0.15); }
.prof-ritualist { color: #52A76F; background-color: rgba(82, 167, 111, 0.15); }
.prof-conduit { color: #F68A87; background-color: rgba(246, 138, 135, 0.15); }
.prof-amalgam { color: #D09C59; background-color: rgba(208, 156, 89, 0.15); }

.prof-unknown { color: #888888; background-color: rgba(136, 136, 136, 0.15); }

.sort-controls button {
    font-weight: 600;
}
.sort-controls button.active {
    border-color: #ffffff;
    color: #ffffff;
}
</style>
<div class="space-y-6 animate-slide-up">
    <!-- Success Header -->
    <div class="glow-card rounded-2xl p-6 border-2 border-green-500/50">
        <div class="flex items-center gap-4 mb-4">
            <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-green-500 to-emerald-500 flex items-center justify-center">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
            <div>
                <h2 class="font-display text-2xl font-bold text-white flex items-center gap-2">
                    üéØ Analyse R√©elle via dps.report
                    <span class="px-2 py-1 rounded-full text-xs bg-green-500/20 text-green-400 border border-green-500/30">
                        ‚úì Donn√©es R√©elles
                    </span>
                </h2>
                <p class="text-gray-400">
                    {{ filename }} ‚Ä¢ Analys√© √† {{ timestamp }}
                </p>
            </div>
        </div>
        
        <!-- Fight Info -->
        <div class="grid grid-cols-2 md:grid-cols-6 gap-4">
            <div class="bg-gw2-darker rounded-xl p-3 text-center">
                <div class="text-sm font-display font-bold text-gw2-purple" title="{{ players.fight_name }}">{{ players.fight_name }}</div>
                <div class="text-xs text-gray-400">{% if lang == 'en' %}Fight{% else %}Combat{% endif %}</div>
            </div>
            <div class="bg-gw2-darker rounded-xl p-3 text-center">
                {% if players.fight_outcome == 'victory' %}
                <div class="text-xl font-display font-bold text-green-400">üèÜ {% if lang == 'en' %}Victory{% else %}Victoire{% endif %}</div>
                {% elif players.fight_outcome == 'defeat' %}
                <div class="text-xl font-display font-bold text-red-400">üíÄ {% if lang == 'en' %}Defeat{% else %}D√©faite{% endif %}</div>
                {% elif players.fight_outcome == 'draw' %}
                <div class="text-xl font-display font-bold text-yellow-400">‚öîÔ∏è {% if lang == 'en' %}Draw{% else %}Match nul{% endif %}</div>
                {% else %}
                <div class="text-xl font-display font-bold text-gray-400">‚ùì {% if lang == 'en' %}Unknown{% else %}Inconnu{% endif %}</div>
                {% endif %}
                <div class="text-xs text-gray-400">{{ players.fight_stats.ally_deaths|default(0) }} {% if lang == 'en' %}deaths{% else %}morts{% endif %} ‚Ä¢ {{ players.fight_stats.ally_downs|default(0) }} downs</div>
            </div>
            <div class="bg-gw2-darker rounded-xl p-3 text-center">
                <div class="text-xl font-display font-bold text-white">
                    {% if players.duration_sec >= 60 %}
                        {{ (players.duration_sec // 60)|int }}m {{ (players.duration_sec % 60)|int }}s
                    {% else %}
                        {{ players.duration_sec|default(0)|int }}s
                    {% endif %}
                </div>
                <div class="text-xs text-gray-400">{% if lang == 'en' %}Duration{% else %}Dur√©e{% endif %}</div>
            </div>
            <div class="bg-gw2-darker rounded-xl p-3 text-center">
                <div class="text-xl font-display font-bold text-cyber-pink">{{ players.allies|length }}</div>
                <div class="text-xs text-gray-400">{% if lang == 'en' %}Allies{% else %}Alli√©s{% endif %}</div>
            </div>
            <div class="bg-gw2-darker rounded-xl p-3 text-center">
                <div class="text-xl font-display font-bold text-red-400">{{ players.enemies|length }}</div>
                <div class="text-xs text-gray-400">{% if lang == 'en' %}Enemies detected{% else %}Ennemis d√©tect√©s{% endif %}</div>
            </div>
            <div class="bg-gw2-darker rounded-xl p-3 text-center">
                <a href="{{ permalink }}" target="_blank" class="text-sm font-display font-bold text-cyber-cyan hover:underline truncate block" title="Voir sur dps.report">
                    dps.report ‚Üí
                </a>
                <div class="text-xs text-gray-400">{% if lang == 'en' %}Full link{% else %}Lien complet{% endif %}</div>
            </div>
        </div>
    </div>
    
    <!-- Squad Composition Summary -->
    {% if players.composition %}
    <div class="glow-card rounded-2xl p-6">
        <h3 class="font-display text-xl font-bold text-green-400 mb-4">üìä {% if lang == 'en' %}Composition Summary{% else %}R√©sum√© de Composition{% endif %}</h3>
        
        <!-- Role Distribution with specs aligned below -->
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
            <!-- DPS -->
            <div class="bg-gw2-darker rounded-xl p-4 border border-orange-500/30">
                <div class="text-center mb-3">
                    <div class="text-3xl font-bold text-orange-400">{{ players.composition.role_counts.dps }}</div>
                    <div class="text-sm text-gray-400">‚öîÔ∏è DPS</div>
                </div>
                <div class="space-y-1">
                    {% for spec, count in players.composition.specs_by_role.dps.items() %}
                    <div class="flex justify-between text-xs">
                        <span class="prof-{{ spec|lower|replace(' ', '') }}">{{ spec }}</span>
                        <span class="text-gray-400">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <!-- Strip -->
            <div class="bg-gw2-darker rounded-xl p-4 border border-purple-500/30">
                <div class="text-center mb-3">
                    <div class="text-3xl font-bold text-purple-400">{{ players.composition.role_counts.dps_strip|default(0) }}</div>
                    <div class="text-sm text-gray-400">üíÄ Strip</div>
                </div>
                <div class="space-y-1">
                    {% for spec, count in players.composition.specs_by_role.dps_strip.items() %}
                    <div class="flex justify-between text-xs">
                        <span class="prof-{{ spec|lower|replace(' ', '') }}">{{ spec }}</span>
                        <span class="text-gray-400">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <!-- Stab -->
            <div class="bg-gw2-darker rounded-xl p-4 border border-yellow-500/30">
                <div class="text-center mb-3">
                    <div class="text-3xl font-bold text-yellow-400">{{ players.composition.role_counts.stab }}</div>
                    <div class="text-sm text-gray-400">üõ°Ô∏è Stab</div>
                </div>
                <div class="space-y-1">
                    {% for spec, count in players.composition.specs_by_role.stab.items() %}
                    <div class="flex justify-between text-xs">
                        <span class="prof-{{ spec|lower|replace(' ', '') }}">{{ spec }}</span>
                        <span class="text-gray-400">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <!-- Healers -->
            <div class="bg-gw2-darker rounded-xl p-4 border border-green-500/30">
                <div class="text-center mb-3">
                    <div class="text-3xl font-bold text-green-400">{{ players.composition.role_counts.healer }}</div>
                    <div class="text-sm text-gray-400">üíö Healers</div>
                </div>
                <div class="space-y-1">
                    {% for spec, count in players.composition.specs_by_role.healer.items() %}
                    <div class="flex justify-between text-xs">
                        <span class="prof-{{ spec|lower|replace(' ', '') }}">{{ spec }}</span>
                        <span class="text-gray-400">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <!-- Boons -->
            <div class="bg-gw2-darker rounded-xl p-4 border border-cyan-500/30">
                <div class="text-center mb-3">
                    <div class="text-3xl font-bold text-cyan-400">{{ players.composition.role_counts.boon }}</div>
                    <div class="text-sm text-gray-400">‚ú® Boons</div>
                </div>
                <div class="space-y-1">
                    {% for spec, count in players.composition.specs_by_role.boon.items() %}
                    <div class="flex justify-between text-xs">
                        <span class="prof-{{ spec|lower|replace(' ', '') }}">{{ spec }}</span>
                        <span class="text-gray-400">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Allied Players -->
    {% if players.allies %}
    <div class="glow-card rounded-2xl p-6">
        <div class="sort-controls flex flex-wrap gap-2 justify-end mb-4 text-xs text-gray-300">
            <span class="uppercase tracking-wide text-gray-500 mr-auto">Tri</span>
            <button type="button" class="sort-btn px-3 py-1 rounded-lg bg-gw2-darker border border-gray-700 hover:border-white transition-all"
                    data-sort-target="allies-table" data-sort-mode="default">
                Par d√©faut
            </button>
            <button type="button" class="sort-btn px-3 py-1 rounded-lg bg-gw2-darker border border-gray-700 hover:border-white transition-all"
                    data-sort-target="allies-table" data-sort-mode="profession">
                {% if lang == 'en' %}By class{% else %}Par classe{% endif %}
            </button>
            <button type="button" class="sort-btn px-3 py-1 rounded-lg bg-gw2-darker border border-gray-700 hover:border-white transition-all"
                    data-sort-target="allies-table" data-sort-mode="group">
                {% if lang == 'en' %}By subgroup{% else %}Par sous-groupe{% endif %}
            </button>
        </div>
        <h3 class="font-display text-xl font-bold text-green-400 mb-4 flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
            üõ°Ô∏è {% if lang == 'en' %}Your Squad{% else %}Ton Escouade{% endif %} ({{ players.allies|length }} {% if lang == 'en' %}players{% else %}joueurs{% endif %})
        </h3>
        
        <div class="overflow-x-auto">
            <table class="w-full text-sm sortable-table" id="allies-table">
                <thead>
                    <tr class="text-left text-gray-400 border-b border-gray-700">
                        <th class="pb-2">{% if lang == 'en' %}Player{% else %}Joueur{% endif %}</th>
                        <th class="pb-2">{% if lang == 'en' %}Class{% else %}Classe{% endif %}</th>
                        <th class="pb-2">{% if lang == 'en' %}Role{% else %}R√¥le{% endif %}</th>
                        <th class="pb-2">{% if lang == 'en' %}Group{% else %}Groupe{% endif %}</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-800">
                    {% for player in players.allies %}
                    <tr class="hover:bg-gw2-darker/50"
                        data-profession="{{ player.profession|lower }}"
                        data-group="{{ player.group }}"
                        data-damage="{{ player.damage }}"
                        data-original-order="{{ loop.index0 }}">
                        <td class="py-2">
                            <div class="flex items-center gap-2">
                                {% if player.is_commander %}
                                <span class="text-yellow-400">üëë</span>
                                {% endif %}
                                <span class="font-medium text-white">{{ player.name }}</span>
                                <span class="text-xs text-gray-500">{{ player.account }}</span>
                            </div>
                        </td>
                        <td class="py-2">
                            <span class="px-2 py-1 rounded text-xs prof-{{ player.profession|lower|replace(' ', '') }}">
                                {{ player.profession }}
                            </span>
                        </td>
                        <td class="py-2">
                            {% if player.role == 'healer' %}
                            <span class="px-2 py-1 rounded text-xs bg-green-500/20 text-green-400 border border-green-500/30">üíö Heal</span>
                            {% elif player.role == 'stab' %}
                            <span class="px-2 py-1 rounded text-xs bg-yellow-500/20 text-yellow-400 border border-yellow-500/30">üõ°Ô∏è Stab</span>
                            {% elif player.role == 'boon' %}
                            <span class="px-2 py-1 rounded text-xs bg-cyan-500/20 text-cyan-400 border border-cyan-500/30">‚ú® Boon</span>
                            {% elif player.role == 'dps_strip' %}
                            <span class="px-2 py-1 rounded text-xs bg-purple-500/20 text-purple-400 border border-purple-500/30">üíÄ Strip</span>
                            {% else %}
                            <span class="px-2 py-1 rounded text-xs bg-orange-500/20 text-orange-400 border border-orange-500/30">‚öîÔ∏è DPS</span>
                            {% endif %}
                        </td>
                        <td class="py-2 text-gray-400">{{ player.group }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}
    
    <!-- DETAILED SQUAD STATISTICS -->
    {% if players.allies %}
    <div class="glow-card rounded-2xl p-6" x-data="{ activeTab: 'damage' }">
        <h3 class="font-display text-xl font-bold text-cyber-cyan mb-4 flex items-center gap-2">
            üìä {% if lang == 'en' %}Detailed Squad Statistics{% else %}Statistiques D√©taill√©es de l'Escouade{% endif %}
        </h3>
        
        <!-- Squad Totals Summary -->
        {% if players.squad_totals %}
        <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-3 mb-6">
            <div class="bg-gw2-darker rounded-xl p-3 text-center border border-orange-500/20">
                <div class="text-lg font-bold text-orange-400">{{ "{:,}".format(players.squad_totals.damage_out|default(0)) }}</div>
                <div class="text-xs text-gray-400">{% if lang == 'en' %}Damage Out{% else %}D√©g√¢ts Out{% endif %}</div>
            </div>
            <div class="bg-gw2-darker rounded-xl p-3 text-center border border-red-500/20">
                <div class="text-lg font-bold text-red-400">{{ "{:,}".format(players.squad_totals.damage_in|default(0)) }}</div>
                <div class="text-xs text-gray-400">{% if lang == 'en' %}Damage In{% else %}D√©g√¢ts In{% endif %}</div>
            </div>
            <div class="bg-gw2-darker rounded-xl p-3 text-center border border-yellow-500/20">
                <div class="text-lg font-bold text-yellow-400">{{ players.squad_totals.damage_ratio|default(0) }}</div>
                <div class="text-xs text-gray-400">Ratio Out/In</div>
            </div>
            <div class="bg-gw2-darker rounded-xl p-3 text-center border border-green-500/20">
                <div class="text-lg font-bold text-green-400">{{ "{:,}".format(players.squad_totals.healing|default(0)) }}</div>
                <div class="text-xs text-gray-400">Heal + Barrier</div>
            </div>
            <div class="bg-gw2-darker rounded-xl p-3 text-center border border-cyan-500/20">
                <div class="text-lg font-bold text-cyan-400">{{ "{:,}".format(players.squad_totals.cleanses|default(0)) }}</div>
                <div class="text-xs text-gray-400">Cleanses</div>
            </div>
            <div class="bg-gw2-darker rounded-xl p-3 text-center border border-purple-500/20">
                <div class="text-lg font-bold text-purple-400">{{ "{:,}".format(players.squad_totals.boon_strips|default(0)) }}</div>
                <div class="text-xs text-gray-400">Boon Strips</div>
            </div>
            <div class="bg-gw2-darker rounded-xl p-3 text-center border border-pink-500/20">
                <div class="text-lg font-bold text-pink-400">{{ "{:,}".format(players.squad_totals.down_contrib|default(0)) }}</div>
                <div class="text-xs text-gray-400">Down Contrib</div>
            </div>
            <div class="bg-gw2-darker rounded-xl p-3 text-center border border-blue-500/20">
                <div class="text-lg font-bold text-blue-400">{{ players.squad_totals.resurrects|default(0) }}</div>
                <div class="text-xs text-gray-400">Resurrects</div>
            </div>
        </div>
        {% endif %}
        
        <!-- Tab Navigation -->
        <div class="flex flex-wrap gap-2 mb-4 border-b border-gray-700 pb-3">
            <button @click="activeTab = 'damage'" :class="activeTab === 'damage' ? 'bg-orange-500/20 text-orange-400 border-orange-500' : 'bg-gw2-darker text-gray-400 border-gray-700'" 
                    class="px-4 py-2 rounded-lg text-sm font-medium border transition-all">‚öîÔ∏è {% if lang == 'en' %}Damage{% else %}D√©g√¢ts{% endif %}</button>
            <button @click="activeTab = 'combat'" :class="activeTab === 'combat' ? 'bg-pink-500/20 text-pink-400 border-pink-500' : 'bg-gw2-darker text-gray-400 border-gray-700'"
                    class="px-4 py-2 rounded-lg text-sm font-medium border transition-all">üíÄ {% if lang == 'en' %}Combat{% else %}Combat{% endif %}</button>
            <button @click="activeTab = 'support'" :class="activeTab === 'support' ? 'bg-green-500/20 text-green-400 border-green-500' : 'bg-gw2-darker text-gray-400 border-gray-700'"
                    class="px-4 py-2 rounded-lg text-sm font-medium border transition-all">üíö {% if lang == 'en' %}Support{% else %}Support{% endif %}</button>
            <button @click="activeTab = 'boons'" :class="activeTab === 'boons' ? 'bg-cyan-500/20 text-cyan-400 border-cyan-500' : 'bg-gw2-darker text-gray-400 border-gray-700'"
                    class="px-4 py-2 rounded-lg text-sm font-medium border transition-all">‚ú® Boons</button>
            <button @click="activeTab = 'defensive'" :class="activeTab === 'defensive' ? 'bg-red-500/20 text-red-400 border-red-500' : 'bg-gw2-darker text-gray-400 border-gray-700'"
                    class="px-4 py-2 rounded-lg text-sm font-medium border transition-all">üõ°Ô∏è {% if lang == 'en' %}Defensive{% else %}D√©fensif{% endif %}</button>
        </div>
        
        <!-- DAMAGE TAB -->
        <div x-show="activeTab === 'damage'">
            <div class="flex flex-wrap gap-2 mb-3 text-xs">
                <span class="text-gray-500">{% if lang == 'en' %}Sort{% else %}Trier{% endif %}:</span>
                <button onclick="sortTableByAttr('damage-table', 'profession')" class="px-2 py-1 rounded bg-gw2-darker border border-gray-700 hover:border-white text-gray-300">{% if lang == 'en' %}Class{% else %}Classe{% endif %}</button>
                <button onclick="sortTableByAttr('damage-table', 'group')" class="px-2 py-1 rounded bg-gw2-darker border border-gray-700 hover:border-white text-gray-300">{% if lang == 'en' %}Group{% else %}Groupe{% endif %}</button>
                <button onclick="sortTableByAttr('damage-table', 'role')" class="px-2 py-1 rounded bg-gw2-darker border border-gray-700 hover:border-white text-gray-300">{% if lang == 'en' %}Role{% else %}R√¥le{% endif %}</button>
            </div>
            <div class="overflow-x-auto">
            <table class="w-full text-sm" id="damage-table">
                <thead>
                    <tr class="text-left text-gray-400 border-b border-gray-700">
                        <th class="pb-2 cursor-pointer hover:text-white" onclick="sortTable('damage-table', 0)">Joueur</th>
                        <th class="pb-2 cursor-pointer hover:text-white" onclick="sortTable('damage-table', 1)">Classe</th>
                        <th class="pb-2 cursor-pointer hover:text-white" onclick="sortTable('damage-table', 2)">R√¥le</th>
                        <th class="pb-2 text-center cursor-pointer hover:text-white" onclick="sortTable('damage-table', 3, true)">Groupe</th>
                        <th class="pb-2 text-right cursor-pointer hover:text-white" onclick="sortTable('damage-table', 4, true)">{% if lang == 'en' %}Damage Dealt{% else %}D√©g√¢ts Inflig√©s{% endif %}</th>
                        <th class="pb-2 text-right cursor-pointer hover:text-white" onclick="sortTable('damage-table', 5, true)" title="D√©g√¢ts par seconde">DPS</th>
                        <th class="pb-2 text-right cursor-pointer hover:text-white" onclick="sortTable('damage-table', 6, true)" title="D√©g√¢ts inflig√©s divis√©s par d√©g√¢ts re√ßus. >1 = tu fais plus de d√©g√¢ts que tu n'en re√ßois">Ratio Out/In</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-800">
                    {% for p in players.allies|sort(attribute='damage_out', reverse=true) %}
                    <tr class="hover:bg-gw2-darker/50" data-profession="{{ p.profession|lower }}" data-group="{{ p.group }}" data-role="{{ p.role }}">
                        <td class="py-2 font-medium text-white">{{ p.name }}</td>
                        <td class="py-2"><span class="px-2 py-1 rounded text-xs prof-{{ p.profession|lower|replace(' ', '') }}">{{ p.profession }}</span></td>
                        <td class="py-2">
                            {% if p.role == 'healer' %}
                            <span class="px-2 py-1 rounded text-xs bg-green-500/20 text-green-400 border border-green-500/30">üíö Heal</span>
                            {% elif p.role == 'stab' %}
                            <span class="px-2 py-1 rounded text-xs bg-yellow-500/20 text-yellow-400 border border-yellow-500/30">üõ°Ô∏è Stab</span>
                            {% elif p.role == 'boon' %}
                            <span class="px-2 py-1 rounded text-xs bg-cyan-500/20 text-cyan-400 border border-cyan-500/30">‚ú® Boon</span>
                            {% elif p.role == 'dps_strip' %}
                            <span class="px-2 py-1 rounded text-xs bg-purple-500/20 text-purple-400 border border-purple-500/30">üíÄ Strip</span>
                            {% else %}
                            <span class="px-2 py-1 rounded text-xs bg-orange-500/20 text-orange-400 border border-orange-500/30">‚öîÔ∏è DPS</span>
                            {% endif %}
                        </td>
                        <td class="py-2 text-center text-gray-400">{{ p.group }}</td>
                        <td class="py-2 text-right font-mono text-orange-400">{{ "{:,}".format(p.damage_out|default(0)) }}</td>
                        <td class="py-2 text-right font-mono text-orange-300">{{ "{:,.0f}".format(p.dps|default(0)) }}</td>
                        <td class="py-2 text-right font-mono text-yellow-400">{{ p.damage_ratio|default(0) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            </div>
        </div>
        
        <!-- COMBAT TAB -->
        <div x-show="activeTab === 'combat'">
            <div class="flex flex-wrap gap-2 mb-3 text-xs">
                <span class="text-gray-500">{% if lang == 'en' %}Sort{% else %}Trier{% endif %}:</span>
                <button onclick="sortTableByAttr('combat-table', 'profession')" class="px-2 py-1 rounded bg-gw2-darker border border-gray-700 hover:border-white text-gray-300">{% if lang == 'en' %}Class{% else %}Classe{% endif %}</button>
                <button onclick="sortTableByAttr('combat-table', 'group')" class="px-2 py-1 rounded bg-gw2-darker border border-gray-700 hover:border-white text-gray-300">{% if lang == 'en' %}Group{% else %}Groupe{% endif %}</button>
                <button onclick="sortTableByAttr('combat-table', 'role')" class="px-2 py-1 rounded bg-gw2-darker border border-gray-700 hover:border-white text-gray-300">{% if lang == 'en' %}Role{% else %}R√¥le{% endif %}</button>
            </div>
            <div class="overflow-x-auto">
            <table class="w-full text-sm" id="combat-table">
                <thead>
                    <tr class="text-left text-gray-400 border-b border-gray-700">
                        <th class="pb-2">{% if lang == 'en' %}Player{% else %}Joueur{% endif %}</th>
                        <th class="pb-2">{% if lang == 'en' %}Class{% else %}Classe{% endif %}</th>
                        <th class="pb-2 cursor-pointer hover:text-white" onclick="sortTable('combat-table', 2)">{% if lang == 'en' %}Role{% else %}R√¥le{% endif %}</th>
                        <th class="pb-2 text-center cursor-pointer hover:text-white" onclick="sortTable('combat-table', 3, true)">{% if lang == 'en' %}Group{% else %}Groupe{% endif %}</th>
                        <th class="pb-2 text-right cursor-pointer hover:text-white" onclick="sortTable('combat-table', 4, true)" title="{% if lang == 'en' %}Damage on downed enemies{% else %}D√©g√¢ts sur ennemis down{% endif %}">Down Contrib</th>
                        <th class="pb-2 text-right cursor-pointer hover:text-white" onclick="sortTable('combat-table', 5, true)" title="{% if lang == 'en' %}Down Contrib per second{% else %}Down Contrib par seconde{% endif %}">DC/s</th>
                        <th class="pb-2 text-right cursor-pointer hover:text-white" onclick="sortTable('combat-table', 6, true)" title="{% if lang == 'en' %}Crowd Control dealt{% else %}Crowd Control inflig√©{% endif %}">CC Out</th>
                        <th class="pb-2 text-right cursor-pointer hover:text-white" onclick="sortTable('combat-table', 7, true)" title="{% if lang == 'en' %}CC per second{% else %}CC par seconde{% endif %}">CC/s</th>
                        <th class="pb-2 text-right cursor-pointer hover:text-white" onclick="sortTable('combat-table', 8, true)" title="{% if lang == 'en' %}Boons stripped from enemies{% else %}Boons retir√©s aux ennemis{% endif %}">Strips Out</th>
                        <th class="pb-2 text-right cursor-pointer hover:text-white" onclick="sortTable('combat-table', 9, true)" title="{% if lang == 'en' %}Strips per second{% else %}Strips par seconde{% endif %}">S/s</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-800">
                    {% for p in players.allies|sort(attribute='down_contrib', reverse=true) %}
                    <tr class="hover:bg-gw2-darker/50" data-profession="{{ p.profession|lower }}" data-group="{{ p.group }}" data-role="{{ p.role }}">
                        <td class="py-2 font-medium text-white">{{ p.name }}</td>
                        <td class="py-2"><span class="px-2 py-1 rounded text-xs prof-{{ p.profession|lower|replace(' ', '') }}">{{ p.profession }}</span></td>
                        <td class="py-2">
                            {% if p.role == 'healer' %}
                            <span class="px-2 py-1 rounded text-xs bg-green-500/20 text-green-400 border border-green-500/30">üíö Heal</span>
                            {% elif p.role == 'stab' %}
                            <span class="px-2 py-1 rounded text-xs bg-yellow-500/20 text-yellow-400 border border-yellow-500/30">üõ°Ô∏è Stab</span>
                            {% elif p.role == 'boon' %}
                            <span class="px-2 py-1 rounded text-xs bg-cyan-500/20 text-cyan-400 border border-cyan-500/30">‚ú® Boon</span>
                            {% elif p.role == 'dps_strip' %}
                            <span class="px-2 py-1 rounded text-xs bg-purple-500/20 text-purple-400 border border-purple-500/30">üíÄ Strip</span>
                            {% else %}
                            <span class="px-2 py-1 rounded text-xs bg-orange-500/20 text-orange-400 border border-orange-500/30">‚öîÔ∏è DPS</span>
                            {% endif %}
                        </td>
                        <td class="py-2 text-center text-gray-400">{{ p.group }}</td>
                        <td class="py-2 text-right font-mono text-pink-400">{{ "{:,}".format(p.down_contrib|default(0)) }}</td>
                        <td class="py-2 text-right font-mono text-pink-300">{{ p.down_contrib_per_sec|default(0) }}</td>
                        <td class="py-2 text-right font-mono text-blue-400">{{ "{:,}".format(p.cc_out|default(0)) }}</td>
                        <td class="py-2 text-right font-mono text-blue-300">{{ p.cc_per_sec|default(0) }}</td>
                        <td class="py-2 text-right font-mono text-purple-400">{{ "{:,}".format(p.boon_strips|default(0)) }}</td>
                        <td class="py-2 text-right font-mono text-purple-300">{{ p.strips_per_sec|default(0) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            </div>
        </div>
        
        <!-- SUPPORT TAB -->
        <div x-show="activeTab === 'support'">
            <div class="flex flex-wrap gap-2 mb-3 text-xs">
                <span class="text-gray-500">{% if lang == 'en' %}Sort{% else %}Trier{% endif %}:</span>
                <button onclick="sortTableByAttr('support-table', 'profession')" class="px-2 py-1 rounded bg-gw2-darker border border-gray-700 hover:border-white text-gray-300">{% if lang == 'en' %}Class{% else %}Classe{% endif %}</button>
                <button onclick="sortTableByAttr('support-table', 'group')" class="px-2 py-1 rounded bg-gw2-darker border border-gray-700 hover:border-white text-gray-300">{% if lang == 'en' %}Group{% else %}Groupe{% endif %}</button>
                <button onclick="sortTableByAttr('support-table', 'role')" class="px-2 py-1 rounded bg-gw2-darker border border-gray-700 hover:border-white text-gray-300">{% if lang == 'en' %}Role{% else %}R√¥le{% endif %}</button>
            </div>
            <div class="overflow-x-auto">
            <table class="w-full text-sm" id="support-table">
                <thead>
                    <tr class="text-left text-gray-400 border-b border-gray-700">
                        <th class="pb-2">{% if lang == 'en' %}Player{% else %}Joueur{% endif %}</th>
                        <th class="pb-2">{% if lang == 'en' %}Class{% else %}Classe{% endif %}</th>
                        <th class="pb-2 cursor-pointer hover:text-white" onclick="sortTable('support-table', 2)">{% if lang == 'en' %}Role{% else %}R√¥le{% endif %}</th>
                        <th class="pb-2 text-center cursor-pointer hover:text-white" onclick="sortTable('support-table', 3, true)">{% if lang == 'en' %}Group{% else %}Groupe{% endif %}</th>
                        <th class="pb-2 text-right cursor-pointer hover:text-white" onclick="sortTable('support-table', 4, true)" title="{% if lang == 'en' %}Direct healing{% else %}Soins directs{% endif %}">Heal</th>
                        <th class="pb-2 text-right cursor-pointer hover:text-white" onclick="sortTable('support-table', 5, true)" title="{% if lang == 'en' %}Barrier applied{% else %}Barrier appliqu√©{% endif %}">Barrier</th>
                        <th class="pb-2 text-right cursor-pointer hover:text-white" onclick="sortTable('support-table', 6, true)" title="{% if lang == 'en' %}Heal+Barrier per second{% else %}Heal+Barrier par seconde{% endif %}">HPS</th>
                        <th class="pb-2 text-right cursor-pointer hover:text-white" onclick="sortTable('support-table', 7, true)">Cleanses</th>
                        <th class="pb-2 text-right cursor-pointer hover:text-white" onclick="sortTable('support-table', 8, true)" title="{% if lang == 'en' %}Cleanses per second{% else %}Cleanses par seconde{% endif %}">C/s</th>
                        <th class="pb-2 text-right cursor-pointer hover:text-white" onclick="sortTable('support-table', 9, true)">Rez</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-800">
                    {% for p in players.allies|sort(attribute='healing', reverse=true) %}
                    <tr class="hover:bg-gw2-darker/50" data-profession="{{ p.profession|lower }}" data-group="{{ p.group }}" data-role="{{ p.role }}">
                        <td class="py-2 font-medium text-white">{{ p.name }}</td>
                        <td class="py-2"><span class="px-2 py-1 rounded text-xs prof-{{ p.profession|lower|replace(' ', '') }}">{{ p.profession }}</span></td>
                        <td class="py-2">
                            {% if p.role == 'healer' %}
                            <span class="px-2 py-1 rounded text-xs bg-green-500/20 text-green-400 border border-green-500/30">üíö Heal</span>
                            {% elif p.role == 'stab' %}
                            <span class="px-2 py-1 rounded text-xs bg-yellow-500/20 text-yellow-400 border border-yellow-500/30">üõ°Ô∏è Stab</span>
                            {% elif p.role == 'boon' %}
                            <span class="px-2 py-1 rounded text-xs bg-cyan-500/20 text-cyan-400 border border-cyan-500/30">‚ú® Boon</span>
                            {% elif p.role == 'dps_strip' %}
                            <span class="px-2 py-1 rounded text-xs bg-purple-500/20 text-purple-400 border border-purple-500/30">üíÄ Strip</span>
                            {% else %}
                            <span class="px-2 py-1 rounded text-xs bg-orange-500/20 text-orange-400 border border-orange-500/30">‚öîÔ∏è DPS</span>
                            {% endif %}
                        </td>
                        <td class="py-2 text-center text-gray-400">{{ p.group }}</td>
                        <td class="py-2 text-right font-mono text-green-400">{{ "{:,}".format(p.heal_only|default(0)) }}</td>
                        <td class="py-2 text-right font-mono text-blue-400">{{ "{:,}".format(p.barrier|default(0)) }}</td>
                        <td class="py-2 text-right font-mono text-green-300">{{ "{:,.0f}".format(p.healing_per_sec|default(0)) }}</td>
                        <td class="py-2 text-right font-mono text-cyan-400">{{ "{:,}".format(p.cleanses|default(0)) }}</td>
                        <td class="py-2 text-right font-mono text-cyan-300">{{ p.cleanses_per_sec|default(0) }}</td>
                        <td class="py-2 text-right font-mono text-blue-400">{{ p.resurrects|default(0) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            </div>
        </div>
        
        <!-- DEFENSIVE TAB -->
        <div x-show="activeTab === 'defensive'">
            <div class="flex flex-wrap gap-2 mb-3 text-xs">
                <span class="text-gray-500">{% if lang == 'en' %}Sort{% else %}Trier{% endif %}:</span>
                <button onclick="sortTableByAttr('defensive-table', 'profession')" class="px-2 py-1 rounded bg-gw2-darker border border-gray-700 hover:border-white text-gray-300">{% if lang == 'en' %}Class{% else %}Classe{% endif %}</button>
                <button onclick="sortTableByAttr('defensive-table', 'group')" class="px-2 py-1 rounded bg-gw2-darker border border-gray-700 hover:border-white text-gray-300">{% if lang == 'en' %}Group{% else %}Groupe{% endif %}</button>
                <button onclick="sortTableByAttr('defensive-table', 'role')" class="px-2 py-1 rounded bg-gw2-darker border border-gray-700 hover:border-white text-gray-300">{% if lang == 'en' %}Role{% else %}R√¥le{% endif %}</button>
            </div>
            <div class="overflow-x-auto">
            <table class="w-full text-sm" id="defensive-table">
                <thead>
                    <tr class="text-left text-gray-400 border-b border-gray-700">
                        <th class="pb-2">{% if lang == 'en' %}Player{% else %}Joueur{% endif %}</th>
                        <th class="pb-2">{% if lang == 'en' %}Class{% else %}Classe{% endif %}</th>
                        <th class="pb-2 cursor-pointer hover:text-white" onclick="sortTable('defensive-table', 2)">{% if lang == 'en' %}Role{% else %}R√¥le{% endif %}</th>
                        <th class="pb-2 text-center cursor-pointer hover:text-white" onclick="sortTable('defensive-table', 3, true)">{% if lang == 'en' %}Group{% else %}Groupe{% endif %}</th>
                        <th class="pb-2 text-right cursor-pointer hover:text-white" onclick="sortTable('defensive-table', 4, true)">Dmg In</th>
                        <th class="pb-2 text-right cursor-pointer hover:text-white" onclick="sortTable('defensive-table', 5, true)">Strips In</th>
                        <th class="pb-2 text-right cursor-pointer hover:text-white" onclick="sortTable('defensive-table', 6, true)">Strips/s</th>
                        <th class="pb-2 text-right cursor-pointer hover:text-white" onclick="sortTable('defensive-table', 7, true)">Deaths</th>
                        <th class="pb-2 text-right cursor-pointer hover:text-white" onclick="sortTable('defensive-table', 8, true)">Downs</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-800">
                    {% for p in players.allies|sort(attribute='damage_in', reverse=true) %}
                    <tr class="hover:bg-gw2-darker/50" data-profession="{{ p.profession|lower }}" data-group="{{ p.group }}" data-role="{{ p.role }}">
                        <td class="py-2 font-medium text-white">{{ p.name }}</td>
                        <td class="py-2"><span class="px-2 py-1 rounded text-xs prof-{{ p.profession|lower|replace(' ', '') }}">{{ p.profession }}</span></td>
                        <td class="py-2">
                            {% if p.role == 'healer' %}
                            <span class="px-2 py-1 rounded text-xs bg-green-500/20 text-green-400 border border-green-500/30">üíö Heal</span>
                            {% elif p.role == 'stab' %}
                            <span class="px-2 py-1 rounded text-xs bg-yellow-500/20 text-yellow-400 border border-yellow-500/30">üõ°Ô∏è Stab</span>
                            {% elif p.role == 'boon' %}
                            <span class="px-2 py-1 rounded text-xs bg-cyan-500/20 text-cyan-400 border border-cyan-500/30">‚ú® Boon</span>
                            {% elif p.role == 'dps_strip' %}
                            <span class="px-2 py-1 rounded text-xs bg-purple-500/20 text-purple-400 border border-purple-500/30">üíÄ Strip</span>
                            {% else %}
                            <span class="px-2 py-1 rounded text-xs bg-orange-500/20 text-orange-400 border border-orange-500/30">‚öîÔ∏è DPS</span>
                            {% endif %}
                        </td>
                        <td class="py-2 text-center text-gray-400">{{ p.group }}</td>
                        <td class="py-2 text-right font-mono text-red-400">{{ "{:,}".format(p.damage_in|default(0)) }}</td>
                        <td class="py-2 text-right font-mono text-purple-400">{{ "{:,}".format(p.boon_strip_in|default(0)) }}</td>
                        <td class="py-2 text-right font-mono text-purple-300">{{ p.strip_in_per_sec|default(0) }}</td>
                        <td class="py-2 text-right font-mono text-red-500">{{ p.deaths|default(0) }}</td>
                        <td class="py-2 text-right font-mono text-red-300">{{ p.downs|default(0) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            </div>
        </div>
        
        <!-- BOONS TAB -->
        <div x-show="activeTab === 'boons'" class="space-y-6">
            <!-- Group Boon Uptimes -->
            {% if players.group_boon_uptimes %}
            <div>
                <h4 class="font-display font-bold text-cyan-400 mb-3">üìä {% if lang == 'en' %}Boon Uptime per Group{% else %}Boon Uptime par Groupe{% endif %}</h4>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="text-left text-gray-400 border-b border-gray-700">
                                <th class="pb-2">{% if lang == 'en' %}Group{% else %}Groupe{% endif %}</th>
                                <th class="pb-2 text-center" title="Quickness - Priorit√© #1"><img src="/static/img/boons/quickness.png" class="w-5 h-5 inline" alt="Quick"> Quick</th>
                                <th class="pb-2 text-center" title="Resistance - Priorit√© #2"><img src="/static/img/boons/resistance.png" class="w-5 h-5 inline" alt="Resist"> Resist</th>
                                <th class="pb-2 text-center" title="Aegis - Priorit√© #3"><img src="/static/img/boons/aegis.png" class="w-5 h-5 inline" alt="Aegis"> Aegis</th>
                                <th class="pb-2 text-center" title="Superspeed - Priorit√© #4"><img src="/static/img/boons/superspeed.png" class="w-5 h-5 inline" alt="Superspeed"> Superspeed</th>
                                <th class="pb-2 text-center"><img src="/static/img/boons/stability.png" class="w-5 h-5 inline" alt="Stab"> Stab</th>
                                <th class="pb-2 text-center"><img src="/static/img/boons/protection.png" class="w-5 h-5 inline" alt="Prot"> Prot</th>
                                <th class="pb-2 text-center"><img src="/static/img/boons/vigor.png" class="w-5 h-5 inline" alt="Vigor"> Vigor</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-800">
                            {% for group, boons in players.group_boon_uptimes.items()|sort %}
                            <tr class="hover:bg-gw2-darker/50">
                                <td class="py-2 font-bold text-white">{% if lang == 'en' %}Group{% else %}Groupe{% endif %} {{ group }}</td>
                                <td class="py-2 text-center font-mono {% if boons.quickness|default(0) >= 80 %}text-green-400{% elif boons.quickness|default(0) >= 50 %}text-yellow-400{% else %}text-red-400{% endif %}">{{ boons.quickness|default(0) }}%</td>
                                <td class="py-2 text-center font-mono {% if boons.resistance|default(0) >= 50 %}text-green-400{% elif boons.resistance|default(0) >= 25 %}text-yellow-400{% else %}text-red-400{% endif %}">{{ boons.resistance|default(0) }}%</td>
                                <td class="py-2 text-center font-mono {% if boons.aegis|default(0) >= 50 %}text-green-400{% elif boons.aegis|default(0) >= 25 %}text-yellow-400{% else %}text-red-400{% endif %}">{{ boons.aegis|default(0) }}%</td>
                                <td class="py-2 text-center font-mono {% if boons.superspeed|default(0) >= 30 %}text-green-400{% elif boons.superspeed|default(0) >= 15 %}text-yellow-400{% else %}text-red-400{% endif %}">{{ boons.superspeed|default(0) }}%</td>
                                <td class="py-2 text-center font-mono {% if boons.stability|default(0) >= 50 %}text-green-400{% elif boons.stability|default(0) >= 25 %}text-yellow-400{% else %}text-red-400{% endif %}">{{ boons.stability|default(0) }}%</td>
                                <td class="py-2 text-center font-mono {% if boons.protection|default(0) >= 80 %}text-green-400{% elif boons.protection|default(0) >= 50 %}text-yellow-400{% else %}text-red-400{% endif %}">{{ boons.protection|default(0) }}%</td>
                                <td class="py-2 text-center font-mono {% if boons.vigor|default(0) >= 80 %}text-green-400{% elif boons.vigor|default(0) >= 50 %}text-yellow-400{% else %}text-red-400{% endif %}">{{ boons.vigor|default(0) }}%</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}
            
            <!-- Individual Boon Generation -->
            <div>
                <h4 class="font-display font-bold text-cyan-400 mb-3">‚ú® {% if lang == 'en' %}Boon Generation per Player{% else %}Boon Generation par Joueur{% endif %}</h4>
                <div class="flex flex-wrap gap-2 mb-3 text-xs">
                    <span class="text-gray-500">{% if lang == 'en' %}Sort{% else %}Trier{% endif %}:</span>
                    <button onclick="sortTableByAttr('boon-gen-table', 'profession')" class="px-2 py-1 rounded bg-gw2-darker border border-gray-700 hover:border-white text-gray-300">{% if lang == 'en' %}Class{% else %}Classe{% endif %}</button>
                    <button onclick="sortTableByAttr('boon-gen-table', 'group')" class="px-2 py-1 rounded bg-gw2-darker border border-gray-700 hover:border-white text-gray-300">{% if lang == 'en' %}Group{% else %}Groupe{% endif %}</button>
                    <button onclick="sortTableByAttr('boon-gen-table', 'role')" class="px-2 py-1 rounded bg-gw2-darker border border-gray-700 hover:border-white text-gray-300">{% if lang == 'en' %}Role{% else %}R√¥le{% endif %}</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm" id="boon-gen-table">
                        <thead>
                            <tr class="text-left text-gray-400 border-b border-gray-700">
                                <th class="pb-2">{% if lang == 'en' %}Player{% else %}Joueur{% endif %}</th>
                                <th class="pb-2">{% if lang == 'en' %}Class{% else %}Classe{% endif %}</th>
                                <th class="pb-2">{% if lang == 'en' %}Role{% else %}R√¥le{% endif %}</th>
                                <th class="pb-2 text-center">{% if lang == 'en' %}Group{% else %}Groupe{% endif %}</th>
                                <th class="pb-2 text-center cursor-pointer hover:text-white" onclick="sortTable('boon-gen-table', 4, true)" title="Quickness - Priorit√© #1"><img src="/static/img/boons/quickness.png" class="w-5 h-5 inline" alt="Quick"> Quick</th>
                                <th class="pb-2 text-center cursor-pointer hover:text-white" onclick="sortTable('boon-gen-table', 5, true)" title="Resistance - Priorit√© #2"><img src="/static/img/boons/resistance.png" class="w-5 h-5 inline" alt="Resist"> Resist</th>
                                <th class="pb-2 text-center cursor-pointer hover:text-white" onclick="sortTable('boon-gen-table', 6, true)" title="Aegis - Priorit√© #3"><img src="/static/img/boons/aegis.png" class="w-5 h-5 inline" alt="Aegis"> Aegis</th>
                                <th class="pb-2 text-center cursor-pointer hover:text-white" onclick="sortTable('boon-gen-table', 7, true)" title="Superspeed - Priorit√© #4"><img src="/static/img/boons/superspeed.png" class="w-5 h-5 inline" alt="Superspeed"> Superspeed</th>
                                <th class="pb-2 text-center cursor-pointer hover:text-white" onclick="sortTable('boon-gen-table', 8, true)"><img src="/static/img/boons/stability.png" class="w-5 h-5 inline" alt="Stab"> Stab</th>
                                <th class="pb-2 text-center cursor-pointer hover:text-white" onclick="sortTable('boon-gen-table', 9, true)"><img src="/static/img/boons/protection.png" class="w-5 h-5 inline" alt="Prot"> Prot</th>
                                <th class="pb-2 text-center cursor-pointer hover:text-white" onclick="sortTable('boon-gen-table', 10, true)"><img src="/static/img/boons/vigor.png" class="w-5 h-5 inline" alt="Vigor"> Vigor</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-800">
                            {% for p in players.allies %}
                            {% if p.boon_gen %}
                            <tr class="hover:bg-gw2-darker/50" data-profession="{{ p.profession|lower }}" data-group="{{ p.group }}" data-role="{{ p.role }}">
                                <td class="py-2 font-medium text-white">{{ p.name }}</td>
                                <td class="py-2"><span class="px-2 py-1 rounded text-xs prof-{{ p.profession|lower|replace(' ', '') }}">{{ p.profession }}</span></td>
                                <td class="py-2">
                                    {% if p.role == 'healer' %}
                                    <span class="px-2 py-1 rounded text-xs bg-green-500/20 text-green-400 border border-green-500/30">üíö Heal</span>
                                    {% elif p.role == 'stab' %}
                                    <span class="px-2 py-1 rounded text-xs bg-yellow-500/20 text-yellow-400 border border-yellow-500/30">üõ°Ô∏è Stab</span>
                                    {% elif p.role == 'boon' %}
                                    <span class="px-2 py-1 rounded text-xs bg-cyan-500/20 text-cyan-400 border border-cyan-500/30">‚ú® Boon</span>
                                    {% elif p.role == 'dps_strip' %}
                                    <span class="px-2 py-1 rounded text-xs bg-purple-500/20 text-purple-400 border border-purple-500/30">üíÄ Strip</span>
                                    {% else %}
                                    <span class="px-2 py-1 rounded text-xs bg-orange-500/20 text-orange-400 border border-orange-500/30">‚öîÔ∏è DPS</span>
                                    {% endif %}
                                </td>
                                <td class="py-2 text-center text-gray-400">{{ p.group }}</td>
                                <td class="py-2 text-center font-mono text-gray-300">{{ p.boon_gen.quickness|default(0)|round(1) }}%</td>
                                <td class="py-2 text-center font-mono text-gray-300">{{ p.boon_gen.resistance|default(0)|round(1) }}%</td>
                                <td class="py-2 text-center font-mono text-gray-300">{{ p.boon_gen.aegis|default(0)|round(1) }}%</td>
                                <td class="py-2 text-center font-mono text-gray-300">{{ p.boon_gen.superspeed|default(0)|round(1) }}%</td>
                                <td class="py-2 text-center font-mono text-gray-300">{{ p.boon_gen.stability|default(0)|round(1) }}%</td>
                                <td class="py-2 text-center font-mono text-gray-300">{{ p.boon_gen.protection|default(0)|round(1) }}%</td>
                                <td class="py-2 text-center font-mono text-gray-300">{{ p.boon_gen.vigor|default(0)|round(1) }}%</td>
                            </tr>
                            {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Enemy Composition Summary with Roles -->
    {% if players.enemy_composition and players.enemy_composition.total > 0 %}
    <div class="glow-card rounded-2xl p-6">
        <h3 class="font-display text-xl font-bold text-red-400 mb-4">üéØ Composition Ennemie Estim√©e ({{ players.enemy_composition.total }} joueurs)</h3>
        
        <!-- Enemy Role Distribution -->
        {% if players.enemy_composition.role_counts %}
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
            <!-- DPS -->
            <div class="bg-gw2-darker rounded-xl p-4 border border-orange-500/30">
                <div class="text-center mb-3">
                    <div class="text-3xl font-bold text-orange-400">{{ players.enemy_composition.role_counts.dps|default(0) }}</div>
                    <div class="text-sm text-gray-400">‚öîÔ∏è DPS</div>
                </div>
                <div class="space-y-1">
                    {% for spec, count in players.enemy_composition.specs_by_role.dps.items() %}
                    <div class="flex justify-between text-xs">
                        <span class="prof-{{ spec|lower|replace(' ', '') }}">{{ spec }}</span>
                        <span class="text-gray-400">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <!-- Strip -->
            <div class="bg-gw2-darker rounded-xl p-4 border border-purple-500/30">
                <div class="text-center mb-3">
                    <div class="text-3xl font-bold text-purple-400">{{ players.enemy_composition.role_counts.dps_strip|default(0) }}</div>
                    <div class="text-sm text-gray-400">üíÄ Strip</div>
                </div>
                <div class="space-y-1">
                    {% for spec, count in players.enemy_composition.specs_by_role.dps_strip.items() %}
                    <div class="flex justify-between text-xs">
                        <span class="prof-{{ spec|lower|replace(' ', '') }}">{{ spec }}</span>
                        <span class="text-gray-400">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <!-- Stab -->
            <div class="bg-gw2-darker rounded-xl p-4 border border-yellow-500/30">
                <div class="text-center mb-3">
                    <div class="text-3xl font-bold text-yellow-400">{{ players.enemy_composition.role_counts.stab|default(0) }}</div>
                    <div class="text-sm text-gray-400">üõ°Ô∏è Stab</div>
                </div>
                <div class="space-y-1">
                    {% for spec, count in players.enemy_composition.specs_by_role.stab.items() %}
                    <div class="flex justify-between text-xs">
                        <span class="prof-{{ spec|lower|replace(' ', '') }}">{{ spec }}</span>
                        <span class="text-gray-400">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <!-- Healers -->
            <div class="bg-gw2-darker rounded-xl p-4 border border-green-500/30">
                <div class="text-center mb-3">
                    <div class="text-3xl font-bold text-green-400">{{ players.enemy_composition.role_counts.healer|default(0) }}</div>
                    <div class="text-sm text-gray-400">üíö Healers</div>
                </div>
                <div class="space-y-1">
                    {% for spec, count in players.enemy_composition.specs_by_role.healer.items() %}
                    <div class="flex justify-between text-xs">
                        <span class="prof-{{ spec|lower|replace(' ', '') }}">{{ spec }}</span>
                        <span class="text-gray-400">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <!-- Boons -->
            <div class="bg-gw2-darker rounded-xl p-4 border border-cyan-500/30">
                <div class="text-center mb-3">
                    <div class="text-3xl font-bold text-cyan-400">{{ players.enemy_composition.role_counts.boon|default(0) }}</div>
                    <div class="text-sm text-gray-400">‚ú® Boons</div>
                </div>
                <div class="space-y-1">
                    {% for spec, count in players.enemy_composition.specs_by_role.boon.items() %}
                    <div class="flex justify-between text-xs">
                        <span class="prof-{{ spec|lower|replace(' ', '') }}">{{ spec }}</span>
                        <span class="text-gray-400">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}
        
        <p class="text-xs text-gray-500 italic">‚ö†Ô∏è R√¥les estim√©s bas√©s sur la sp√©cialisation (pas de stats disponibles pour les ennemis)</p>
    </div>
    {% endif %}
    
    <!-- Enemy Players Table -->
    {% if players.enemies %}
    <div class="glow-card rounded-2xl p-6">
        <div class="sort-controls flex flex-wrap gap-2 justify-end mb-4 text-xs text-gray-300">
            <span class="uppercase tracking-wide text-gray-500 mr-auto">Tri</span>
            <button type="button" class="sort-btn px-3 py-1 rounded-lg bg-gw2-darker border border-gray-700 hover:border-white transition-all"
                    data-sort-target="enemies-table" data-sort-mode="default">
                Par d√©faut
            </button>
            <button type="button" class="sort-btn px-3 py-1 rounded-lg bg-gw2-darker border border-gray-700 hover:border-white transition-all"
                    data-sort-target="enemies-table" data-sort-mode="profession">
                Par classe
            </button>
            <button type="button" class="sort-btn px-3 py-1 rounded-lg bg-gw2-darker border border-gray-700 hover:border-white transition-all"
                    data-sort-target="enemies-table" data-sort-mode="damage">
                Par d√©g√¢ts subis
            </button>
        </div>
        <h3 class="font-display text-xl font-bold text-red-400 mb-4 flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
            </svg>
            ‚öîÔ∏è D√©tail Escouade Adverse ({{ players.enemies|length }} joueurs)
        </h3>

        <div class="overflow-x-auto">
            <table class="w-full text-sm sortable-table" id="enemies-table">
                <thead>
                    <tr class="text-left text-gray-400 border-b border-gray-700">
                        <th class="pb-2">Joueur</th>
                        <th class="pb-2">Classe</th>
                        <th class="pb-2">R√¥le estim√©</th>
                        <th class="pb-2 text-right">D√©g√¢ts subis</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-800">
                    {% for enemy in players.enemies %}
                    <tr class="hover:bg-gw2-darker/50"
                        data-profession="{{ enemy.profession|lower }}"
                        data-group="0"
                        data-damage="{{ enemy.damage_taken }}"
                        data-original-order="{{ loop.index0 }}">
                        <td class="py-2">
                            <span class="font-medium text-white">{{ enemy.name }}</span>
                        </td>
                        <td class="py-2">
                            <span class="px-2 py-1 rounded text-xs prof-{{ enemy.profession|lower|replace(' ', '') }}">
                                {{ enemy.profession }}
                            </span>
                        </td>
                        <td class="py-2">
                            {% if enemy.role == 'healer' %}
                            <span class="px-2 py-1 rounded text-xs bg-green-500/20 text-green-400 border border-green-500/30">üíö Heal</span>
                            {% elif enemy.role == 'stab' %}
                            <span class="px-2 py-1 rounded text-xs bg-yellow-500/20 text-yellow-400 border border-yellow-500/30">üõ°Ô∏è Stab</span>
                            {% elif enemy.role == 'boon' %}
                            <span class="px-2 py-1 rounded text-xs bg-cyan-500/20 text-cyan-400 border border-cyan-500/30">‚ú® Boon</span>
                            {% elif enemy.role == 'dps_strip' %}
                            <span class="px-2 py-1 rounded text-xs bg-purple-500/20 text-purple-400 border border-purple-500/30">üíÄ Strip</span>
                            {% else %}
                            <span class="px-2 py-1 rounded text-xs bg-orange-500/20 text-orange-400 border border-orange-500/30">‚öîÔ∏è DPS</span>
                            {% endif %}
                        </td>
                        <td class="py-2 text-right font-mono text-red-300">
                            {{ "{:,}".format(enemy.damage_taken) }}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}
    
    <!-- IA VIVANTE Counter Section -->
    {% if ai_counter %}
    <div class="glow-card rounded-2xl p-6 border-2 border-red-500/50 bg-gradient-to-br from-red-900/20 to-gw2-darker">
        <!-- IA VIVANTE Header -->
        <div class="flex items-center justify-between mb-6">
            <div class="flex items-center gap-3">
                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-red-500 to-orange-500 flex items-center justify-center animate-pulse">
                    <span class="text-2xl">‚ö°</span>
                </div>
                <div>
                    <h3 class="font-display text-2xl font-black text-red-400 tracking-tight">
                        IA VIVANTE
                    </h3>
                    <p class="text-sm text-gray-400">
                        Pr√©cision <span class="text-red-400 font-bold">{{ ai_counter.precision }}%</span> 
                        (bas√©e sur <span class="text-white font-medium">{{ ai_counter.fights_analyzed }}</span> fights r√©els)
                    </p>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <span class="px-3 py-1 rounded-full text-xs bg-red-500/20 text-red-400 border border-red-500/30 font-medium">
                    {% if ai_counter.fallback %}
                    üîÑ Mode Fallback
                    {% else %}
                    üß† Llama 3.2 8B
                    {% endif %}
                </span>
            </div>
        </div>
        
        <!-- Enemy Composition Analyzed -->
        <div class="bg-gw2-darker/80 rounded-xl p-4 mb-4 border border-red-500/20">
            <div class="text-xs text-gray-500 uppercase tracking-wide mb-2">Composition ennemie analys√©e</div>
            <div class="text-white font-medium">{{ ai_counter.enemy_composition }}</div>
        </div>
        
        <!-- AI Counter Recommendation -->
        <div class="bg-gradient-to-r from-red-900/30 to-orange-900/30 rounded-xl p-5 border border-red-500/30">
            <div class="text-xs text-red-400 uppercase tracking-wide mb-3 flex items-center gap-2">
                <span class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></span>
                Counter g√©n√©r√© par IA
            </div>
            <div class="text-white text-lg leading-relaxed whitespace-pre-line font-medium">{{ ai_counter.counter }}</div>
        </div>
        
        <!-- Similar Fights Info -->
        {% if ai_counter.similar_fights > 0 %}
        <div class="mt-4 text-center text-sm text-gray-500">
            Bas√© sur <span class="text-red-400 font-medium">{{ ai_counter.similar_fights }}</span> fights similaires dans notre base
        </div>
        {% endif %}
        
        <!-- BEST BUILDS AGAINST THIS COMP -->
        {% if ai_counter.best_builds %}
        <div class="mt-6 pt-6 border-t border-red-500/20">
            <h4 class="font-display text-lg font-bold text-orange-400 mb-4 flex items-center gap-2">
                üèÜ MEILLEURS BUILDS R√âELS CONTRE CETTE COMP
            </h4>
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                {% for role, build in ai_counter.best_builds.items() %}
                <div class="bg-gw2-darker rounded-xl p-4 border border-orange-500/30 hover:border-orange-500 transition-all">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center gap-2">
                            <span class="px-2 py-1 rounded-lg bg-orange-500/30 text-orange-300 font-bold text-lg">{{ build.recommended_count|default(1) }}x</span>
                            <span class="font-display font-bold text-white text-lg">{{ build.spec }}</span>
                        </div>
                        <span class="px-2 py-1 rounded text-xs 
                            {% if role == 'healer' %}bg-green-500/20 text-green-400 border border-green-500/30
                            {% elif role == 'stab' %}bg-yellow-500/20 text-yellow-400 border border-yellow-500/30
                            {% elif role == 'dps_strip' %}bg-purple-500/20 text-purple-400 border border-purple-500/30
                            {% elif role == 'boon' %}bg-cyan-500/20 text-cyan-400 border border-cyan-500/30
                            {% else %}bg-orange-500/20 text-orange-400 border border-orange-500/30{% endif %}">
                            {{ role }}
                        </span>
                    </div>
                    
                    <!-- Win Rate -->
                    <div class="flex items-center gap-2 mb-3">
                        <div class="flex-1 h-2 bg-gray-700 rounded-full overflow-hidden">
                            <div class="h-full rounded-full {% if build.win_rate >= 80 %}bg-green-500{% elif build.win_rate >= 60 %}bg-yellow-500{% else %}bg-red-500{% endif %}" 
                                 style="width: {{ build.win_rate }}%"></div>
                        </div>
                        <span class="text-sm font-bold {% if build.win_rate >= 80 %}text-green-400{% elif build.win_rate >= 60 %}text-yellow-400{% else %}text-red-400{% endif %}">
                            {{ build.win_rate }}%
                        </span>
                    </div>
                    
                    <div class="text-xs text-gray-400 mb-2">
                        Sur <span class="text-white font-medium">{{ build.fights_played }}</span> fights r√©els
                    </div>
                    
                    <!-- Stats -->
                    <div class="grid grid-cols-2 gap-2 text-xs">
                        {% if build.avg_dps > 0 %}
                        <div class="bg-gw2-darker/50 rounded p-2">
                            <div class="text-orange-400 font-mono">{{ "{:,.0f}".format(build.avg_dps) }}</div>
                            <div class="text-gray-500">DPS moy.</div>
                        </div>
                        {% endif %}
                        {% if build.avg_healing > 0 %}
                        <div class="bg-gw2-darker/50 rounded p-2">
                            <div class="text-green-400 font-mono">{{ "{:,.0f}".format(build.avg_healing) }}</div>
                            <div class="text-gray-500">Heal moy.</div>
                        </div>
                        {% endif %}
                        {% if build.avg_strips > 0 %}
                        <div class="bg-gw2-darker/50 rounded p-2">
                            <div class="text-purple-400 font-mono">{{ build.avg_strips }}</div>
                            <div class="text-gray-500">Strips moy.</div>
                        </div>
                        {% endif %}
                        {% if build.avg_cleanses > 0 %}
                        <div class="bg-gw2-darker/50 rounded p-2">
                            <div class="text-cyan-400 font-mono">{{ build.avg_cleanses }}</div>
                            <div class="text-gray-500">Cleanses moy.</div>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <p class="mt-4 text-xs text-gray-500 italic text-center">
                Ces builds ont historiquement gagn√© contre des compositions similaires
            </p>
        </div>
        {% endif %}
        
        <!-- Powered By Badge -->
        <div class="mt-4 flex justify-center">
            <span class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-gw2-darker border border-gray-700 text-xs text-gray-400">
                <span class="w-2 h-2 rounded-full bg-green-500"></span>
                Powered by {{ ai_counter.model }}
            </span>
        </div>
    </div>
    {% endif %}
    
    <!-- Link to full report -->
    <div class="text-center">
        <a href="{{ permalink }}" target="_blank" 
           class="inline-flex items-center gap-2 px-6 py-3 rounded-xl bg-gradient-to-r from-gw2-purple to-cyber-pink hover:from-cyber-pink hover:to-gw2-purple transition-all font-display font-bold">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
            </svg>
            Voir le rapport complet sur dps.report
        </a>
        <p class="mt-2 text-sm text-gray-500">
            Analyse compl√®te avec graphiques, rotations et statistiques d√©taill√©es
        </p>
    </div>
</div>

<script>
(function() {
    function initSortingControls() {
        document.querySelectorAll('.sort-controls .sort-btn').forEach(btn => {
            btn.onclick = function(event) {
                const tableId = this.dataset.sortTarget;
                const mode = this.dataset.sortMode;
                const table = document.getElementById(tableId);
                if (!table) {
                    console.log('Table not found:', tableId);
                    return;
                }

                // Update active state
                this.parentElement.querySelectorAll('.sort-btn').forEach(b => {
                    b.classList.remove('border-white');
                    b.classList.add('border-gray-700');
                });
                this.classList.remove('border-gray-700');
                this.classList.add('border-white');

                const rows = Array.from(table.querySelectorAll('tbody tr'));
                if (mode === 'default') {
                    rows.sort((a, b) => Number(a.dataset.originalOrder) - Number(b.dataset.originalOrder));
                } else if (mode === 'profession') {
                    rows.sort((a, b) => (a.dataset.profession || '').localeCompare(b.dataset.profession || ''));
                } else if (mode === 'group') {
                    rows.sort((a, b) => Number(a.dataset.group || 0) - Number(b.dataset.group || 0));
                } else if (mode === 'damage') {
                    rows.sort((a, b) => Number(b.dataset.damage || 0) - Number(a.dataset.damage || 0));
                }

                const tbody = table.querySelector('tbody');
                rows.forEach(row => tbody.appendChild(row));
            };
        });
    }

    // Initialize immediately since this script is in the HTMX-loaded content
    initSortingControls();
    
    // Generic table sorting function for detailed stats
    window.sortTable = function(tableId, colIndex, isNumeric = false) {
        const table = document.getElementById(tableId);
        if (!table) return;
        
        const tbody = table.querySelector('tbody');
        const rows = Array.from(tbody.querySelectorAll('tr'));
        
        // Determine current sort direction
        const header = table.querySelectorAll('th')[colIndex];
        const isAsc = header.dataset.sortDir === 'asc';
        header.dataset.sortDir = isAsc ? 'desc' : 'asc';
        
        rows.sort((a, b) => {
            const aVal = a.cells[colIndex]?.textContent.trim().replace(/[,%]/g, '') || '';
            const bVal = b.cells[colIndex]?.textContent.trim().replace(/[,%]/g, '') || '';
            
            if (isNumeric) {
                const aNum = parseFloat(aVal) || 0;
                const bNum = parseFloat(bVal) || 0;
                return isAsc ? aNum - bNum : bNum - aNum;
            }
            return isAsc ? aVal.localeCompare(bVal) : bVal.localeCompare(aVal);
        });
        
        rows.forEach(row => tbody.appendChild(row));
    };
    
    // Sort table by data attribute (profession, group, role)
    window.sortTableByAttr = function(tableId, attr) {
        const table = document.getElementById(tableId);
        if (!table) return;
        
        const tbody = table.querySelector('tbody');
        const rows = Array.from(tbody.querySelectorAll('tr'));
        
        rows.sort((a, b) => {
            const aVal = a.dataset[attr] || '';
            const bVal = b.dataset[attr] || '';
            
            if (attr === 'group') {
                return Number(aVal) - Number(bVal);
            }
            return aVal.localeCompare(bVal);
        });
        
        rows.forEach(row => tbody.appendChild(row));
    };
})();
</script>
