<!-- Evening Analysis Result V2 - Real dps.report data -->
<div class="space-y-6 animate-slide-up">
    <!-- Success Header -->
    <div class="glow-card rounded-2xl p-6 border-2 border-gw2-purple/50">
        <div class="flex items-center gap-4 mb-4">
            <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-gw2-purple to-cyber-pink flex items-center justify-center">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
            <div>
                <h2 class="font-display text-2xl font-bold text-white">
                    ğŸ”® Rapport de SoirÃ©e
                </h2>
                <p class="text-gray-400">
                    {{ file_count }} fichiers analysÃ©s via dps.report â€¢ Session {{ session_id[:8] }}
                </p>
            </div>
        </div>
    </div>
    
    <!-- Stats Overview -->
    <div class="grid grid-cols-2 md:grid-cols-6 gap-4">
        <div class="glow-card rounded-xl p-4 text-center">
            <div class="text-3xl font-display font-bold text-gw2-purple">{{ stats.total_fights }}</div>
            <div class="text-xs text-gray-400 mt-1">Combats</div>
        </div>
        <div class="glow-card rounded-xl p-4 text-center">
            <div class="text-3xl font-display font-bold text-green-400">{{ stats.victories }}</div>
            <div class="text-xs text-gray-400 mt-1">ğŸ† Victoires</div>
        </div>
        <div class="glow-card rounded-xl p-4 text-center">
            <div class="text-3xl font-display font-bold text-red-400">{{ stats.defeats }}</div>
            <div class="text-xs text-gray-400 mt-1">ğŸ’€ DÃ©faites</div>
        </div>
        <div class="glow-card rounded-xl p-4 text-center">
            <div class="text-3xl font-display font-bold text-cyber-pink">{{ stats.total_duration_min }}</div>
            <div class="text-xs text-gray-400 mt-1">Minutes totales</div>
        </div>
        <div class="glow-card rounded-xl p-4 text-center">
            <div class="text-3xl font-display font-bold text-cyber-cyan">{{ stats.avg_players }}</div>
            <div class="text-xs text-gray-400 mt-1">Joueurs moyens</div>
        </div>
        <div class="glow-card rounded-xl p-4 text-center">
            <div class="text-3xl font-display font-bold text-white">{{ composition.spec_counts|length }}</div>
            <div class="text-xs text-gray-400 mt-1">Specs jouÃ©es</div>
        </div>
    </div>
    
    
    <!-- Top Specs Most Played -->
    <div class="glow-card rounded-2xl p-6">
        <h3 class="font-display text-xl font-bold text-cyber-cyan mb-4 flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
            </svg>
            ğŸ“Š SpÃ©cialisations les plus jouÃ©es
        </h3>
        <div class="grid grid-cols-2 md:grid-cols-6 gap-3">
            {% for spec, count in composition.spec_counts.items() %}
            {% if loop.index <= 12 %}
            <div class="bg-gw2-darker rounded-lg p-3 text-center border border-cyber-cyan/20 hover:border-cyber-cyan/50 transition-all">
                <div class="text-2xl font-bold text-cyber-cyan">{{ count }}</div>
                <div class="text-xs prof-{{ spec|lower|replace(' ', '') }} truncate">{{ spec }}</div>
            </div>
            {% endif %}
            {% endfor %}
        </div>
    </div>
    
    
    
    <!-- Squad Composition Summary (like Quick Analysis) -->
    {% if composition %}
    <div class="glow-card rounded-2xl p-6">
        <h3 class="font-display text-xl font-bold text-green-400 mb-4">ğŸ“Š Composition de ton Escouade (Total sur {{ stats.total_fights }} combats)</h3>
        
        <!-- Role Distribution with specs aligned below -->
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
            <!-- DPS -->
            <div class="bg-gw2-darker rounded-xl p-4 border border-orange-500/30">
                <div class="text-center mb-3">
                    <div class="text-3xl font-bold text-orange-400">{{ composition.role_counts.dps }}</div>
                    <div class="text-sm text-gray-400">âš”ï¸ DPS</div>
                </div>
                <div class="space-y-1">
                    {% for spec, count in composition.specs_by_role.dps.items() %}
                    <div class="flex justify-between text-xs">
                        <span class="prof-{{ spec|lower|replace(' ', '') }}">{{ spec }}</span>
                        <span class="text-gray-400">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <!-- Strip -->
            <div class="bg-gw2-darker rounded-xl p-4 border border-purple-500/30">
                <div class="text-center mb-3">
                    <div class="text-3xl font-bold text-purple-400">{{ composition.role_counts.dps_strip|default(0) }}</div>
                    <div class="text-sm text-gray-400">ğŸ’€ Strip</div>
                </div>
                <div class="space-y-1">
                    {% for spec, count in composition.specs_by_role.dps_strip.items() %}
                    <div class="flex justify-between text-xs">
                        <span class="prof-{{ spec|lower|replace(' ', '') }}">{{ spec }}</span>
                        <span class="text-gray-400">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <!-- Stab -->
            <div class="bg-gw2-darker rounded-xl p-4 border border-yellow-500/30">
                <div class="text-center mb-3">
                    <div class="text-3xl font-bold text-yellow-400">{{ composition.role_counts.stab }}</div>
                    <div class="text-sm text-gray-400">ğŸ›¡ï¸ Stab</div>
                </div>
                <div class="space-y-1">
                    {% for spec, count in composition.specs_by_role.stab.items() %}
                    <div class="flex justify-between text-xs">
                        <span class="prof-{{ spec|lower|replace(' ', '') }}">{{ spec }}</span>
                        <span class="text-gray-400">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <!-- Healers -->
            <div class="bg-gw2-darker rounded-xl p-4 border border-green-500/30">
                <div class="text-center mb-3">
                    <div class="text-3xl font-bold text-green-400">{{ composition.role_counts.healer }}</div>
                    <div class="text-sm text-gray-400">ğŸ’š Healers</div>
                </div>
                <div class="space-y-1">
                    {% for spec, count in composition.specs_by_role.healer.items() %}
                    <div class="flex justify-between text-xs">
                        <span class="prof-{{ spec|lower|replace(' ', '') }}">{{ spec }}</span>
                        <span class="text-gray-400">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <!-- Boons -->
            <div class="bg-gw2-darker rounded-xl p-4 border border-cyan-500/30">
                <div class="text-center mb-3">
                    <div class="text-3xl font-bold text-cyan-400">{{ composition.role_counts.boon }}</div>
                    <div class="text-sm text-gray-400">âœ¨ Boons</div>
                </div>
                <div class="space-y-1">
                    {% for spec, count in composition.specs_by_role.boon.items() %}
                    <div class="flex justify-between text-xs">
                        <span class="prof-{{ spec|lower|replace(' ', '') }}">{{ spec }}</span>
                        <span class="text-gray-400">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Enemy Composition Summary -->
    {% if enemy_composition and enemy_composition.total > 0 %}
    <div class="glow-card rounded-2xl p-6">
        <h3 class="font-display text-xl font-bold text-red-400 mb-4">ğŸ‘¹ Composition Moyenne du Serveur Adverse ({{ enemy_composition.total }} joueurs dÃ©tectÃ©s)</h3>
        
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-4">
            <div class="bg-gw2-darker rounded-xl p-3 text-center border border-orange-500/30">
                <div class="text-2xl font-bold text-orange-400">{{ enemy_composition.role_counts.dps|default(0) }}</div>
                <div class="text-xs text-gray-400">âš”ï¸ DPS</div>
            </div>
            <div class="bg-gw2-darker rounded-xl p-3 text-center border border-purple-500/30">
                <div class="text-2xl font-bold text-purple-400">{{ enemy_composition.role_counts.dps_strip|default(0) }}</div>
                <div class="text-xs text-gray-400">ğŸ’€ Strip</div>
            </div>
            <div class="bg-gw2-darker rounded-xl p-3 text-center border border-yellow-500/30">
                <div class="text-2xl font-bold text-yellow-400">{{ enemy_composition.role_counts.stab|default(0) }}</div>
                <div class="text-xs text-gray-400">ğŸ›¡ï¸ Stab</div>
            </div>
            <div class="bg-gw2-darker rounded-xl p-3 text-center border border-green-500/30">
                <div class="text-2xl font-bold text-green-400">{{ enemy_composition.role_counts.healer|default(0) }}</div>
                <div class="text-xs text-gray-400">ğŸ’š Healers</div>
            </div>
            <div class="bg-gw2-darker rounded-xl p-3 text-center border border-cyan-500/30">
                <div class="text-2xl font-bold text-cyan-400">{{ enemy_composition.role_counts.boon|default(0) }}</div>
                <div class="text-xs text-gray-400">âœ¨ Boons</div>
            </div>
        </div>
        
        <!-- Top enemy specs -->
        <div class="grid grid-cols-3 md:grid-cols-6 gap-2">
            {% for spec, count in enemy_composition.spec_counts.items() %}
            {% if loop.index <= 6 %}
            <div class="bg-gw2-darker rounded-lg p-2 text-center border border-red-500/20">
                <div class="text-lg font-bold text-red-400">{{ count }}</div>
                <div class="text-xs text-gray-400 truncate">{{ spec }}</div>
            </div>
            {% endif %}
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <!-- Map/Zone Heatmap -->
    {% if map_counts %}
    <div class="glow-card rounded-2xl p-6">
        <h3 class="font-display text-xl font-bold text-amber-400 mb-4">ğŸ—ºï¸ Zones les plus fightÃ©es</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            {% for map_name, count in map_counts %}
            <div class="bg-gw2-darker rounded-xl p-4 flex items-center justify-between border border-amber-500/20 hover:border-amber-500/50 transition-all">
                <span class="text-white font-medium truncate">{{ map_name }}</span>
                <div class="flex items-center gap-2">
                    <div class="w-24 h-2 rounded-full bg-gw2-dark overflow-hidden">
                        {% set max_count = map_counts[0][1] if map_counts else 1 %}
                        <div class="h-full bg-gradient-to-r from-amber-400 to-orange-500" style="width: {{ (count / max_count * 100)|int }}%"></div>
                    </div>
                    <span class="text-amber-400 font-bold">{{ count }}</span>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <!-- Top 10 Players -->
    {% if top_players %}
    <div class="glow-card rounded-2xl p-6">
        <h3 class="font-display text-xl font-bold text-cyber-pink mb-4">ğŸ… Top 10 Joueurs (par dÃ©gÃ¢ts totaux)</h3>
        <div class="overflow-x-auto">
            <table class="w-full text-sm" id="top-players-table">
                <thead>
                    <tr class="text-left text-gray-400 border-b border-gray-700">
                        <th class="pb-3 pr-4 cursor-pointer hover:text-white" onclick="sortTable('top-players-table', 0)"># â†•</th>
                        <th class="pb-3 pr-4 cursor-pointer hover:text-white" onclick="sortTable('top-players-table', 1)">Joueur â†•</th>
                        <th class="pb-3 pr-4 cursor-pointer hover:text-white" onclick="sortTable('top-players-table', 2)">Build â†•</th>
                        <th class="pb-3 pr-4 cursor-pointer hover:text-white" onclick="sortTable('top-players-table', 3, true)">DÃ©gÃ¢ts totaux â†•</th>
                        <th class="pb-3 pr-4 cursor-pointer hover:text-white" onclick="sortTable('top-players-table', 4, true)">Kills â†•</th>
                        <th class="pb-3 pr-4 cursor-pointer hover:text-white" onclick="sortTable('top-players-table', 5, true)">Deaths â†•</th>
                        <th class="pb-3 cursor-pointer hover:text-white" onclick="sortTable('top-players-table', 6, true)">Apparitions â†•</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-800">
                    {% for player in top_players %}
                    <tr class="hover:bg-gw2-darker/50">
                        <td class="py-3 pr-4">
                            {% if loop.index == 1 %}ğŸ¥‡{% elif loop.index == 2 %}ğŸ¥ˆ{% elif loop.index == 3 %}ğŸ¥‰{% else %}{{ loop.index }}{% endif %}
                        </td>
                        <td class="py-3 pr-4 text-white font-medium">{{ player.name }}</td>
                        <td class="py-3 pr-4 prof-{{ player.spec|lower|replace(' ', '') }}">{{ player.spec }}</td>
                        <td class="py-3 pr-4 text-cyber-pink font-bold">{{ "{:,.0f}".format(player.damage) }}</td>
                        <td class="py-3 pr-4 text-green-400">{{ player.kills }}</td>
                        <td class="py-3 pr-4 text-red-400">{{ player.deaths }}</td>
                        <td class="py-3 text-gray-400">{{ player.appearances }}/{{ stats.total_fights }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}
    
    <!-- Build le plus jouÃ© par classe -->
    {% if builds_by_class %}
    <div class="glow-card rounded-2xl p-6">
        <h3 class="font-display text-xl font-bold text-gw2-purple mb-4">ğŸ® Build le plus jouÃ© par classe</h3>
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3">
            {% for base_class, data in builds_by_class.items() %}
            <div class="bg-gw2-darker rounded-xl p-4 text-center border border-gw2-purple/20 hover:border-gw2-purple/50 transition-all">
                <div class="text-xs text-gray-500 mb-1">{{ base_class }}</div>
                <div class="font-bold prof-{{ data.spec|lower|replace(' ', '') }}">{{ data.spec }}</div>
                <div class="text-sm text-gray-400">{{ data.count }} fois</div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <!-- Counter Recommendation for Next Session -->
    {% if counter_recommendation %}
    <div class="glow-card rounded-2xl p-6 border-2 border-cyber-cyan/50">
        <h3 class="font-display text-xl font-bold text-cyber-cyan mb-4">ğŸ¯ Counter Parfait pour Demain Soir</h3>
        <div class="bg-gw2-darker rounded-xl p-4">
            <div class="flex items-center gap-4 mb-3">
                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-cyber-cyan to-blue-500 flex items-center justify-center">
                    <span class="text-2xl">âš”ï¸</span>
                </div>
                <div>
                    <p class="text-white font-medium">Cible principale: <span class="text-red-400 font-bold">{{ counter_recommendation.target }}</span> ({{ counter_recommendation.count }} dÃ©tectÃ©s)</p>
                    <p class="text-gray-400 text-sm">{{ counter_recommendation.suggestion }}</p>
                </div>
            </div>
            <div class="text-xs text-gray-500 mt-2">
                ğŸ’¡ Conseil: Adaptez votre composition en fonction des specs ennemies dominantes observÃ©es ce soir.
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Fight List -->
    <div class="glow-card rounded-2xl p-6">
        <h3 class="font-display text-xl font-bold text-white mb-4">âš”ï¸ DÃ©tail des Combats</h3>
        
        <div class="overflow-x-auto">
            <table class="w-full text-sm" id="fights-table">
                <thead>
                    <tr class="text-left text-gray-400 border-b border-gray-700">
                        <th class="pb-3 pr-4 cursor-pointer hover:text-white" onclick="sortTable('fights-table', 0)">Fichier â†•</th>
                        <th class="pb-3 pr-4 cursor-pointer hover:text-white" onclick="sortTable('fights-table', 1)">Combat â†•</th>
                        <th class="pb-3 pr-4 cursor-pointer hover:text-white" onclick="sortTable('fights-table', 2)">RÃ©sultat â†•</th>
                        <th class="pb-3 pr-4 cursor-pointer hover:text-white" onclick="sortTable('fights-table', 3, true)">DurÃ©e â†•</th>
                        <th class="pb-3 pr-4 cursor-pointer hover:text-white" onclick="sortTable('fights-table', 4, true)">AlliÃ©s â†•</th>
                        <th class="pb-3 pr-4 cursor-pointer hover:text-white" onclick="sortTable('fights-table', 5)">Stats â†•</th>
                        <th class="pb-3 cursor-pointer hover:text-white" onclick="sortTable('fights-table', 6)">Lien â†•</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-800">
                    {% for fight in fights %}
                    <tr class="hover:bg-gw2-darker/50">
                        <td class="py-3 pr-4 text-gray-300">{{ fight.filename[:25] }}{% if fight.filename|length > 25 %}...{% endif %}</td>
                        <td class="py-3 pr-4 text-gw2-purple font-medium">{{ fight.fight_name[:30] }}{% if fight.fight_name|length > 30 %}...{% endif %}</td>
                        <td class="py-3 pr-4">
                            {% if fight.fight_outcome == 'victory' %}
                            <span class="text-green-400">ğŸ† Victoire</span>
                            {% elif fight.fight_outcome == 'defeat' %}
                            <span class="text-red-400">ğŸ’€ DÃ©faite</span>
                            {% elif fight.fight_outcome == 'draw' %}
                            <span class="text-yellow-400">âš”ï¸ Nul</span>
                            {% else %}
                            <span class="text-gray-400">â“</span>
                            {% endif %}
                        </td>
                        <td class="py-3 pr-4 text-white">
                            {% if fight.duration_sec >= 60 %}
                                {{ (fight.duration_sec // 60)|int }}m {{ (fight.duration_sec % 60)|int }}s
                            {% else %}
                                {{ fight.duration_sec|int }}s
                            {% endif %}
                        </td>
                        <td class="py-3 pr-4 text-cyber-pink">{{ fight.allies_count }}</td>
                        <td class="py-3 pr-4 text-xs text-gray-400">
                            {{ fight.fight_stats.ally_deaths|default(0) }} morts â€¢ {{ fight.fight_stats.ally_downs|default(0) }} downs
                        </td>
                        <td class="py-3">
                            <a href="{{ fight.permalink }}" target="_blank" class="text-cyber-cyan hover:underline">
                                dps.report â†’
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        {% if fights|length == 0 %}
        <div class="text-center py-8 text-gray-400">
            Aucun combat n'a pu Ãªtre analysÃ©. VÃ©rifiez que vos fichiers sont valides.
        </div>
        {% endif %}
    </div>
</div>
