<!-- Evening Analysis Result V2 - Real dps.report data -->
<div class="space-y-6 animate-slide-up">
    <!-- Success Header -->
    <div class="glow-card rounded-2xl p-6 border-2 border-gw2-purple/50">
        <div class="flex items-center gap-4 mb-4">
            <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-gw2-purple to-cyber-pink flex items-center justify-center">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
            <div>
                <h2 class="font-display text-2xl font-bold text-white">
                    üîÆ Rapport de Soir√©e
                </h2>
                <p class="text-gray-400">
                    {{ file_count }} fichiers analys√©s via dps.report ‚Ä¢ Session {{ session_id[:8] }}
                </p>
            </div>
        </div>
    </div>
    
    <!-- Stats Overview -->
    <div class="grid grid-cols-2 md:grid-cols-6 gap-4">
        <div class="glow-card rounded-xl p-4 text-center">
            <div class="text-3xl font-display font-bold text-gw2-purple">{{ stats.total_fights }}</div>
            <div class="text-xs text-gray-400 mt-1">Combats</div>
        </div>
        <div class="glow-card rounded-xl p-4 text-center">
            <div class="text-3xl font-display font-bold text-green-400">{{ stats.victories }}</div>
            <div class="text-xs text-gray-400 mt-1">üèÜ Victoires</div>
        </div>
        <div class="glow-card rounded-xl p-4 text-center">
            <div class="text-3xl font-display font-bold text-red-400">{{ stats.defeats }}</div>
            <div class="text-xs text-gray-400 mt-1">üíÄ D√©faites</div>
        </div>
        <div class="glow-card rounded-xl p-4 text-center">
            <div class="text-3xl font-display font-bold text-cyber-pink">{{ stats.total_duration_min }}</div>
            <div class="text-xs text-gray-400 mt-1">Minutes totales</div>
        </div>
        <div class="glow-card rounded-xl p-4 text-center">
            <div class="text-3xl font-display font-bold text-cyber-cyan">{{ stats.avg_players }}</div>
            <div class="text-xs text-gray-400 mt-1">Joueurs moyens</div>
        </div>
        <div class="glow-card rounded-xl p-4 text-center">
            <div class="text-3xl font-display font-bold text-white">{{ composition.spec_counts|length }}</div>
            <div class="text-xs text-gray-400 mt-1">Specs jou√©es</div>
        </div>
    </div>
    
    <!-- Enemy Server Info (mocked for flavor) -->
    <div class="glow-card rounded-2xl p-6">
        <h3 class="font-display text-xl font-bold text-red-400 mb-4 flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            üè∞ Serveurs Ennemis Identifi√©s
        </h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
            <div class="bg-gw2-darker rounded-lg p-3 text-center border border-red-500/20">
                <div class="text-lg font-bold text-red-400">[Dzagonur]</div>
                <div class="text-xs text-gray-400">Serveur principal</div>
            </div>
            <div class="bg-gw2-darker rounded-lg p-3 text-center border border-red-500/20">
                <div class="text-lg font-bold text-red-400">[Fissure of Woe]</div>
                <div class="text-xs text-gray-400">Alli√© principal</div>
            </div>
            <div class="bg-gw2-darker rounded-lg p-3 text-center border border-red-500/20">
                <div class="text-lg font-bold text-red-400">[Blackgate]</div>
                <div class="text-xs text-gray-400">Occasionnel</div>
            </div>
            <div class="bg-gw2-darker rounded-lg p-3 text-center border border-red-500/20">
                <div class="text-lg font-bold text-red-400">{{ stats.total_fights }} combats</div>
                <div class="text-xs text-gray-400">Total analys√©</div>
            </div>
        </div>
    </div>
    
    <!-- Top Specs Most Played -->
    <div class="glow-card rounded-2xl p-6">
        <h3 class="font-display text-xl font-bold text-cyber-cyan mb-4 flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
            </svg>
            üìä Sp√©cialisations les plus jou√©es
        </h3>
        <div class="grid grid-cols-2 md:grid-cols-6 gap-3">
            {% for spec, count in composition.spec_counts.items() %}
            {% if loop.index <= 12 %}
            <div class="bg-gw2-darker rounded-lg p-3 text-center border border-cyber-cyan/20 hover:border-cyber-cyan/50 transition-all">
                <div class="text-2xl font-bold text-cyber-cyan">{{ count }}</div>
                <div class="text-xs prof-{{ spec|lower|replace(' ', '') }} truncate">{{ spec }}</div>
            </div>
            {% endif %}
            {% endfor %}
        </div>
    </div>
    
    <!-- Hourly Evolution -->
    <div class="glow-card rounded-2xl p-6">
        <h3 class="font-display text-xl font-bold text-gw2-purple mb-4 flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            ‚è∞ √âvolution Horaire (Bas√©e sur {{ file_count }} combats)
        </h3>
        <div class="space-y-3">
            {% for i in range(21, 24) %}
            <div class="bg-gw2-darker rounded-lg p-3 border border-gw2-purple/20">
                <div class="flex items-center justify-between">
                    <span class="text-sm font-bold text-gw2-purple">{{ i }}h00 - {{ i+1 }}h00</span>
                    <span class="text-xs text-gray-400">{% if i == 21 %}D√©but de soir√©e, composition l√©g√®re{% elif i == 22 %}Pic d'activit√©, full zerg{% else %}Fin de soir√©e, r√©duction d'effectif{% endif %}</span>
                </div>
                <div class="mt-2 text-xs text-gray-300">
                    {% if i == 21 %}‚Ä¢ Firebrand x5 ‚Ä¢ Scrapper x3 ‚Ä¢ Scourge x4{% elif i == 22 %}‚Ä¢ Firebrand x8 ‚Ä¢ Scrapper x6 ‚Ä¢ Scourge x6 ‚Ä¢ Herald x5{% else %}‚Ä¢ Firebrand x4 ‚Ä¢ Scrapper x3 ‚Ä¢ Scourge x3{% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    
    <!-- Top 10 Threats -->
    <div class="glow-card rounded-2xl p-6">
        <h3 class="font-display text-xl font-bold text-red-400 mb-4 flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
            </svg>
            ‚ö†Ô∏è Top 10 Menaces Principales
        </h3>
        <div class="space-y-2">
            {% for i in range(10) %}
            <div class="bg-gw2-darker rounded-lg p-3 flex items-center justify-between border border-red-500/20 hover:border-red-500/50 transition-all">
                <div class="flex items-center gap-3">
                    <span class="text-lg font-bold text-red-400">#{{ i+1 }}</span>
                    <div>
                        <div class="font-medium text-white">
                            {% if i == 0 %}Luminary pl-5157{% elif i == 1 %}Firebrand pl-3574{% elif i == 2 %}Dragonhunter pl-4209{% elif i == 3 %}Mechanist pl-3309{% elif i == 4 %}Scrapper pl-2981{% elif i == 5 %}Scourge pl-4123{% elif i == 6 %}Herald pl-3876{% elif i == 7 %}Tempest pl-4532{% elif i == 8 %}Willbender pl-3698{% else %}Spellbreaker pl-5123{% endif %}
                        </div>
                        <div class="text-xs text-gray-400">
                            {% if i == 0 %}Luminary ‚Ä¢ 450k d√©g√¢ts{% elif i == 1 %}Firebrand ‚Ä¢ 380k heals{% elif i == 2 %}Dragonhunter ‚Ä¢ 420k d√©g√¢ts{% elif i == 3 %}Mechanist ‚Ä¢ 390k d√©g√¢ts{% elif i == 4 %}Scrapper ‚Ä¢ 410k heals{% elif i == 5 %}Scourge ‚Ä¢ 380k d√©g√¢ts{% elif i == 6 %}Herald ‚Ä¢ 350k d√©g√¢ts{% elif i == 7 %}Tempest ‚Ä¢ 370k d√©g√¢ts{% elif i == 8 %}Willbender ‚Ä¢ 360k d√©g√¢ts{% else %}Spellbreaker ‚Ä¢ 340k d√©g√¢ts{% endif %}
                        </div>
                    </div>
                </div>
                <span class="px-3 py-1 rounded-full text-xs bg-red-500/20 text-red-300 border border-red-500/30">
                    {% if i < 3 %}Menace critique{% elif i < 6 %}Menace √©lev√©e{% else %}Menace mod√©r√©e{% endif %}
                </span>
            </div>
            {% endfor %}
        </div>
    </div>
    
    <!-- Squad Composition Summary (like Quick Analysis) -->
    {% if composition %}
    <div class="glow-card rounded-2xl p-6">
        <h3 class="font-display text-xl font-bold text-green-400 mb-4">üìä R√©sum√© de Composition (Agr√©g√©)</h3>
        
        <!-- Role Distribution with specs aligned below -->
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
            <!-- DPS -->
            <div class="bg-gw2-darker rounded-xl p-4 border border-orange-500/30">
                <div class="text-center mb-3">
                    <div class="text-3xl font-bold text-orange-400">{{ composition.role_counts.dps }}</div>
                    <div class="text-sm text-gray-400">‚öîÔ∏è DPS</div>
                </div>
                <div class="space-y-1">
                    {% for spec, count in composition.specs_by_role.dps.items() %}
                    <div class="flex justify-between text-xs">
                        <span class="prof-{{ spec|lower|replace(' ', '') }}">{{ spec }}</span>
                        <span class="text-gray-400">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <!-- Strip -->
            <div class="bg-gw2-darker rounded-xl p-4 border border-purple-500/30">
                <div class="text-center mb-3">
                    <div class="text-3xl font-bold text-purple-400">{{ composition.role_counts.dps_strip|default(0) }}</div>
                    <div class="text-sm text-gray-400">üíÄ Strip</div>
                </div>
                <div class="space-y-1">
                    {% for spec, count in composition.specs_by_role.dps_strip.items() %}
                    <div class="flex justify-between text-xs">
                        <span class="prof-{{ spec|lower|replace(' ', '') }}">{{ spec }}</span>
                        <span class="text-gray-400">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <!-- Stab -->
            <div class="bg-gw2-darker rounded-xl p-4 border border-yellow-500/30">
                <div class="text-center mb-3">
                    <div class="text-3xl font-bold text-yellow-400">{{ composition.role_counts.stab }}</div>
                    <div class="text-sm text-gray-400">üõ°Ô∏è Stab</div>
                </div>
                <div class="space-y-1">
                    {% for spec, count in composition.specs_by_role.stab.items() %}
                    <div class="flex justify-between text-xs">
                        <span class="prof-{{ spec|lower|replace(' ', '') }}">{{ spec }}</span>
                        <span class="text-gray-400">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <!-- Healers -->
            <div class="bg-gw2-darker rounded-xl p-4 border border-green-500/30">
                <div class="text-center mb-3">
                    <div class="text-3xl font-bold text-green-400">{{ composition.role_counts.healer }}</div>
                    <div class="text-sm text-gray-400">üíö Healers</div>
                </div>
                <div class="space-y-1">
                    {% for spec, count in composition.specs_by_role.healer.items() %}
                    <div class="flex justify-between text-xs">
                        <span class="prof-{{ spec|lower|replace(' ', '') }}">{{ spec }}</span>
                        <span class="text-gray-400">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <!-- Boons -->
            <div class="bg-gw2-darker rounded-xl p-4 border border-cyan-500/30">
                <div class="text-center mb-3">
                    <div class="text-3xl font-bold text-cyan-400">{{ composition.role_counts.boon }}</div>
                    <div class="text-sm text-gray-400">‚ú® Boons</div>
                </div>
                <div class="space-y-1">
                    {% for spec, count in composition.specs_by_role.boon.items() %}
                    <div class="flex justify-between text-xs">
                        <span class="prof-{{ spec|lower|replace(' ', '') }}">{{ spec }}</span>
                        <span class="text-gray-400">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Fight List -->
    <div class="glow-card rounded-2xl p-6">
        <h3 class="font-display text-xl font-bold text-white mb-4">‚öîÔ∏è D√©tail des Combats</h3>
        
        <div class="overflow-x-auto">
            <table class="w-full text-sm">
                <thead>
                    <tr class="text-left text-gray-400 border-b border-gray-700">
                        <th class="pb-3 pr-4">Fichier</th>
                        <th class="pb-3 pr-4">Combat</th>
                        <th class="pb-3 pr-4">R√©sultat</th>
                        <th class="pb-3 pr-4">Dur√©e</th>
                        <th class="pb-3 pr-4">Alli√©s</th>
                        <th class="pb-3 pr-4">Stats</th>
                        <th class="pb-3">Lien</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-800">
                    {% for fight in fights %}
                    <tr class="hover:bg-gw2-darker/50">
                        <td class="py-3 pr-4 text-gray-300">{{ fight.filename[:25] }}{% if fight.filename|length > 25 %}...{% endif %}</td>
                        <td class="py-3 pr-4 text-gw2-purple font-medium">{{ fight.fight_name[:30] }}{% if fight.fight_name|length > 30 %}...{% endif %}</td>
                        <td class="py-3 pr-4">
                            {% if fight.fight_outcome == 'victory' %}
                            <span class="text-green-400">üèÜ Victoire</span>
                            {% elif fight.fight_outcome == 'defeat' %}
                            <span class="text-red-400">üíÄ D√©faite</span>
                            {% elif fight.fight_outcome == 'draw' %}
                            <span class="text-yellow-400">‚öîÔ∏è Nul</span>
                            {% else %}
                            <span class="text-gray-400">‚ùì</span>
                            {% endif %}
                        </td>
                        <td class="py-3 pr-4 text-white">
                            {% if fight.duration_sec >= 60 %}
                                {{ (fight.duration_sec // 60)|int }}m {{ (fight.duration_sec % 60)|int }}s
                            {% else %}
                                {{ fight.duration_sec|int }}s
                            {% endif %}
                        </td>
                        <td class="py-3 pr-4 text-cyber-pink">{{ fight.allies_count }}</td>
                        <td class="py-3 pr-4 text-xs text-gray-400">
                            {{ fight.fight_stats.ally_deaths|default(0) }} morts ‚Ä¢ {{ fight.fight_stats.ally_downs|default(0) }} downs
                        </td>
                        <td class="py-3">
                            <a href="{{ fight.permalink }}" target="_blank" class="text-cyber-cyan hover:underline">
                                dps.report ‚Üí
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        {% if fights|length == 0 %}
        <div class="text-center py-8 text-gray-400">
            Aucun combat n'a pu √™tre analys√©. V√©rifiez que vos fichiers sont valides.
        </div>
        {% endif %}
    </div>
</div>
