<!-- Evening Analysis Result V2 - Real dps.report data -->
<div class="space-y-6 animate-slide-up">
    <!-- Success Header -->
    <div class="glow-card rounded-2xl p-6 border-2 border-gw2-purple/50">
        <div class="flex items-center gap-4 mb-4">
            <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-gw2-purple to-cyber-pink flex items-center justify-center">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
            <div>
                <h2 class="font-display text-2xl font-bold text-white">
                    üîÆ Rapport de Soir√©e
                </h2>
                <p class="text-gray-400">
                    {{ file_count }} fichiers analys√©s via dps.report ‚Ä¢ Session {{ session_id[:8] }}
                </p>
            </div>
        </div>
    </div>
    
    <!-- Stats Overview -->
    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-3">
        <div class="glow-card rounded-xl p-4 text-center">
            <div class="text-3xl font-display font-bold text-gw2-purple">{{ stats.total_fights }}</div>
            <div class="text-xs text-gray-400 mt-1">Combats</div>
        </div>
        <div class="glow-card rounded-xl p-4 text-center">
            <div class="text-3xl font-display font-bold text-green-400">{{ stats.victories }}</div>
            <div class="text-xs text-gray-400 mt-1">üèÜ Victoires</div>
        </div>
        <div class="glow-card rounded-xl p-4 text-center">
            <div class="text-3xl font-display font-bold text-red-400">{{ stats.defeats }}</div>
            <div class="text-xs text-gray-400 mt-1">üíÄ D√©faites</div>
        </div>
        <div class="glow-card rounded-xl p-4 text-center">
            <div class="text-3xl font-display font-bold text-yellow-400">{{ stats.draws|default(0) }}</div>
            <div class="text-xs text-gray-400 mt-1">‚öîÔ∏è Nuls</div>
        </div>
        <div class="glow-card rounded-xl p-4 text-center">
            <div class="text-3xl font-display font-bold text-cyber-pink">{{ stats.total_duration_min }}</div>
            <div class="text-xs text-gray-400 mt-1">Minutes</div>
        </div>
        <div class="glow-card rounded-xl p-4 text-center">
            <div class="text-3xl font-display font-bold text-cyan-400">{{ stats.unique_players|default(stats.avg_players) }}</div>
            <div class="text-xs text-gray-400 mt-1">üë• Joueurs</div>
        </div>
        <div class="glow-card rounded-xl p-4 text-center">
            <div class="text-3xl font-display font-bold text-amber-400">{{ stats.avg_players }}</div>
            <div class="text-xs text-gray-400 mt-1">Moy/Combat</div>
        </div>
        <div class="glow-card rounded-xl p-4 text-center">
            <div class="text-3xl font-display font-bold text-white">{{ composition.spec_counts|length }}</div>
            <div class="text-xs text-gray-400 mt-1">Specs</div>
        </div>
    </div>
    
    
    <!-- Squad Composition Summary (like Quick Analysis) -->
    {% if composition %}
    <div class="glow-card rounded-2xl p-6">
        <h3 class="font-display text-xl font-bold text-green-400 mb-4">üìä Composition de ton Escouade (Total sur {{ stats.total_fights }} combats)</h3>
        
        <!-- Role Distribution with specs aligned below -->
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
            <!-- DPS -->
            <div class="bg-gw2-darker rounded-xl p-4 border border-orange-500/30">
                <div class="text-center mb-3">
                    <div class="text-3xl font-bold text-orange-400">{{ composition.role_counts.dps }}</div>
                    <div class="text-sm text-gray-400">‚öîÔ∏è DPS</div>
                </div>
                <div class="space-y-1">
                    {% for spec, count in composition.specs_by_role.dps.items() %}
                    <div class="flex justify-between text-xs">
                        <span class="prof-{{ spec|lower|replace(' ', '') }}">{{ spec }}</span>
                        <span class="text-gray-400">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <!-- Strip -->
            <div class="bg-gw2-darker rounded-xl p-4 border border-purple-500/30">
                <div class="text-center mb-3">
                    <div class="text-3xl font-bold text-purple-400">{{ composition.role_counts.dps_strip|default(0) }}</div>
                    <div class="text-sm text-gray-400">üíÄ Strip</div>
                </div>
                <div class="space-y-1">
                    {% for spec, count in composition.specs_by_role.dps_strip.items() %}
                    <div class="flex justify-between text-xs">
                        <span class="prof-{{ spec|lower|replace(' ', '') }}">{{ spec }}</span>
                        <span class="text-gray-400">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <!-- Stab -->
            <div class="bg-gw2-darker rounded-xl p-4 border border-yellow-500/30">
                <div class="text-center mb-3">
                    <div class="text-3xl font-bold text-yellow-400">{{ composition.role_counts.stab }}</div>
                    <div class="text-sm text-gray-400">üõ°Ô∏è Stab</div>
                </div>
                <div class="space-y-1">
                    {% for spec, count in composition.specs_by_role.stab.items() %}
                    <div class="flex justify-between text-xs">
                        <span class="prof-{{ spec|lower|replace(' ', '') }}">{{ spec }}</span>
                        <span class="text-gray-400">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <!-- Healers -->
            <div class="bg-gw2-darker rounded-xl p-4 border border-green-500/30">
                <div class="text-center mb-3">
                    <div class="text-3xl font-bold text-green-400">{{ composition.role_counts.healer }}</div>
                    <div class="text-sm text-gray-400">üíö Healers</div>
                </div>
                <div class="space-y-1">
                    {% for spec, count in composition.specs_by_role.healer.items() %}
                    <div class="flex justify-between text-xs">
                        <span class="prof-{{ spec|lower|replace(' ', '') }}">{{ spec }}</span>
                        <span class="text-gray-400">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <!-- Boons -->
            <div class="bg-gw2-darker rounded-xl p-4 border border-cyan-500/30">
                <div class="text-center mb-3">
                    <div class="text-3xl font-bold text-cyan-400">{{ composition.role_counts.boon }}</div>
                    <div class="text-sm text-gray-400">‚ú® Boons</div>
                </div>
                <div class="space-y-1">
                    {% for spec, count in composition.specs_by_role.boon.items() %}
                    <div class="flex justify-between text-xs">
                        <span class="prof-{{ spec|lower|replace(' ', '') }}">{{ spec }}</span>
                        <span class="text-gray-400">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Enemy Composition Summary -->
    {% if enemy_composition and enemy_composition.total > 0 %}
    <div class="glow-card rounded-2xl p-6">
        <h3 class="font-display text-xl font-bold text-red-400 mb-4">üëπ Composition Moyenne du Serveur Adverse ({{ enemy_composition.total }} joueurs d√©tect√©s)</h3>
        
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-4">
            <div class="bg-gw2-darker rounded-xl p-3 text-center border border-orange-500/30">
                <div class="text-2xl font-bold text-orange-400">{{ enemy_composition.role_counts.dps|default(0) }}</div>
                <div class="text-xs text-gray-400">‚öîÔ∏è DPS</div>
            </div>
            <div class="bg-gw2-darker rounded-xl p-3 text-center border border-purple-500/30">
                <div class="text-2xl font-bold text-purple-400">{{ enemy_composition.role_counts.dps_strip|default(0) }}</div>
                <div class="text-xs text-gray-400">üíÄ Strip</div>
            </div>
            <div class="bg-gw2-darker rounded-xl p-3 text-center border border-yellow-500/30">
                <div class="text-2xl font-bold text-yellow-400">{{ enemy_composition.role_counts.stab|default(0) }}</div>
                <div class="text-xs text-gray-400">üõ°Ô∏è Stab</div>
            </div>
            <div class="bg-gw2-darker rounded-xl p-3 text-center border border-green-500/30">
                <div class="text-2xl font-bold text-green-400">{{ enemy_composition.role_counts.healer|default(0) }}</div>
                <div class="text-xs text-gray-400">üíö Healers</div>
            </div>
            <div class="bg-gw2-darker rounded-xl p-3 text-center border border-cyan-500/30">
                <div class="text-2xl font-bold text-cyan-400">{{ enemy_composition.role_counts.boon|default(0) }}</div>
                <div class="text-xs text-gray-400">‚ú® Boons</div>
            </div>
        </div>
        
        <!-- Top enemy specs -->
        <div class="grid grid-cols-3 md:grid-cols-6 gap-2">
            {% for spec, count in enemy_composition.spec_counts.items() %}
            {% if loop.index <= 6 %}
            <div class="bg-gw2-darker rounded-lg p-2 text-center border border-red-500/20">
                <div class="text-lg font-bold text-red-400">{{ count }}</div>
                <div class="text-xs text-gray-400 truncate">{{ spec }}</div>
            </div>
            {% endif %}
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <!-- Top 10 Players -->
    {% if top_players %}
    <div class="glow-card rounded-2xl p-6">
        <h3 class="font-display text-xl font-bold text-cyber-pink mb-4">üèÖ Top 10 Joueurs (par d√©g√¢ts totaux)</h3>
        <div class="overflow-x-auto">
            <table class="w-full text-sm" id="top-players-table">
                <thead>
                    <tr class="text-left text-gray-400 border-b border-gray-700">
                        <th class="pb-3 pr-4 cursor-pointer hover:text-white" onclick="sortTable('top-players-table', 0)" title="Classement par d√©g√¢ts totaux"># ‚Üï</th>
                        <th class="pb-3 pr-4 cursor-pointer hover:text-white" onclick="sortTable('top-players-table', 1)" title="Nom du joueur">Joueur ‚Üï</th>
                        <th class="pb-3 pr-4 cursor-pointer hover:text-white" onclick="sortTable('top-players-table', 2)" title="Sp√©cialisation √©lite la plus jou√©e">Build ‚Üï</th>
                        <th class="pb-3 pr-4 cursor-pointer hover:text-white" onclick="sortTable('top-players-table', 3, true)" title="Somme des d√©g√¢ts sur tous les combats">D√©g√¢ts totaux ‚Üï</th>
                        <th class="pb-3 pr-4 cursor-pointer hover:text-white" onclick="sortTable('top-players-table', 4, true)" title="Nombre total de kills">Kills ‚Üï</th>
                        <th class="pb-3 pr-4 cursor-pointer hover:text-white" onclick="sortTable('top-players-table', 5, true)" title="Nombre total de morts">Deaths ‚Üï</th>
                        <th class="pb-3 cursor-pointer hover:text-white" onclick="sortTable('top-players-table', 6, true)" title="Nombre de combats auxquels le joueur a particip√©">Apparitions ‚Üï</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-800">
                    {% for player in top_players %}
                    <tr class="hover:bg-gw2-darker/50">
                        <td class="py-3 pr-4">
                            {% if loop.index == 1 %}ü•á{% elif loop.index == 2 %}ü•à{% elif loop.index == 3 %}ü•â{% else %}{{ loop.index }}{% endif %}
                        </td>
                        <td class="py-3 pr-4 text-white font-medium">{{ player.name }}</td>
                        <td class="py-3 pr-4 prof-{{ player.spec|lower|replace(' ', '') }}">{{ player.spec }}</td>
                        <td class="py-3 pr-4 text-cyber-pink font-bold">{{ "{:,.0f}".format(player.damage) }}</td>
                        <td class="py-3 pr-4 text-green-400">{{ player.kills }}</td>
                        <td class="py-3 pr-4 text-red-400">{{ player.deaths }}</td>
                        <td class="py-3 text-gray-400">{{ player.appearances }}/{{ stats.total_fights }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}
    
    <!-- Fight List -->
    <div class="glow-card rounded-2xl p-6">
        <h3 class="font-display text-xl font-bold text-white mb-4">‚öîÔ∏è D√©tail des Combats</h3>
        
        <div class="overflow-x-auto">
            <table class="w-full text-sm" id="fights-table">
                <thead>
                    <tr class="text-left text-gray-400 border-b border-gray-700">
                        <th class="pb-3 pr-4 cursor-pointer hover:text-white" onclick="sortTable('fights-table', 0)" title="Nom du fichier analys√©">Fichier ‚Üï</th>
                        <th class="pb-3 pr-4 cursor-pointer hover:text-white" onclick="sortTable('fights-table', 1)" title="Nom du combat d√©tect√©">Combat ‚Üï</th>
                        <th class="pb-3 pr-4 cursor-pointer hover:text-white" onclick="sortTable('fights-table', 2)" title="Victoire/D√©faite/Nul bas√© sur les morts et downs">R√©sultat ‚Üï</th>
                        <th class="pb-3 pr-4 cursor-pointer hover:text-white" onclick="sortTable('fights-table', 3, true)" title="Dur√©e totale du combat">Dur√©e ‚Üï</th>
                        <th class="pb-3 pr-4 cursor-pointer hover:text-white" onclick="sortTable('fights-table', 4, true)" title="Nombre de joueurs alli√©s dans ce combat">Alli√©s ‚Üï</th>
                        <th class="pb-3 pr-4 cursor-pointer hover:text-white" onclick="sortTable('fights-table', 5)" title="Morts et downs de l'√©quipe">Stats ‚Üï</th>
                        <th class="pb-3 cursor-pointer hover:text-white" onclick="sortTable('fights-table', 6)" title="Lien vers le rapport complet dps.report">Lien ‚Üï</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-800">
                    {% for fight in fights %}
                    <tr class="hover:bg-gw2-darker/50">
                        <td class="py-3 pr-4 text-gray-300">{{ fight.filename[:25] }}{% if fight.filename|length > 25 %}...{% endif %}</td>
                        <td class="py-3 pr-4 text-gw2-purple font-medium">{{ fight.fight_name[:30] }}{% if fight.fight_name|length > 30 %}...{% endif %}</td>
                        <td class="py-3 pr-4">
                            {% if fight.fight_outcome == 'victory' %}
                            <span class="text-green-400">üèÜ Victoire</span>
                            {% elif fight.fight_outcome == 'defeat' %}
                            <span class="text-red-400">üíÄ D√©faite</span>
                            {% elif fight.fight_outcome == 'draw' %}
                            <span class="text-yellow-400">‚öîÔ∏è Nul</span>
                            {% else %}
                            <span class="text-gray-400">‚ùì</span>
                            {% endif %}
                        </td>
                        <td class="py-3 pr-4 text-white">
                            {% if fight.duration_sec >= 60 %}
                                {{ (fight.duration_sec // 60)|int }}m {{ (fight.duration_sec % 60)|int }}s
                            {% else %}
                                {{ fight.duration_sec|int }}s
                            {% endif %}
                        </td>
                        <td class="py-3 pr-4 text-cyber-pink">{{ fight.allies_count }}</td>
                        <td class="py-3 pr-4 text-xs text-gray-400">
                            {{ fight.fight_stats.ally_deaths|default(0) }} morts ‚Ä¢ {{ fight.fight_stats.ally_downs|default(0) }} downs
                        </td>
                        <td class="py-3">
                            <a href="{{ fight.permalink }}" target="_blank" class="text-cyber-cyan hover:underline">
                                dps.report ‚Üí
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        {% if fights|length == 0 %}
        <div class="text-center py-8 text-gray-400">
            Aucun combat n'a pu √™tre analys√©. V√©rifiez que vos fichiers sont valides.
        </div>
        {% endif %}
    </div>
</div>
