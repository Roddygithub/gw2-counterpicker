<!-- Evening Analysis Result V2 - Real dps.report data -->
<div class="space-y-6 animate-slide-up">
    <!-- Success Header -->
    <div class="glow-card rounded-2xl p-6 border-2 border-gw2-purple/50">
        <div class="flex items-center gap-4 mb-4">
            <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-gw2-purple to-cyber-pink flex items-center justify-center">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
            <div>
                <h2 class="font-display text-2xl font-bold text-white">
                    üîÆ Rapport de Soir√©e
                </h2>
                <p class="text-gray-400">
                    {{ file_count }} fichiers analys√©s via dps.report ‚Ä¢ Session {{ session_id[:8] }}
                </p>
            </div>
        </div>
    </div>
    
    <!-- Stats Overview -->
    <div class="grid grid-cols-2 md:grid-cols-6 gap-4">
        <div class="glow-card rounded-xl p-4 text-center">
            <div class="text-3xl font-display font-bold text-gw2-purple">{{ stats.total_fights }}</div>
            <div class="text-xs text-gray-400 mt-1">Combats</div>
        </div>
        <div class="glow-card rounded-xl p-4 text-center">
            <div class="text-3xl font-display font-bold text-green-400">{{ stats.victories }}</div>
            <div class="text-xs text-gray-400 mt-1">üèÜ Victoires</div>
        </div>
        <div class="glow-card rounded-xl p-4 text-center">
            <div class="text-3xl font-display font-bold text-red-400">{{ stats.defeats }}</div>
            <div class="text-xs text-gray-400 mt-1">üíÄ D√©faites</div>
        </div>
        <div class="glow-card rounded-xl p-4 text-center">
            <div class="text-3xl font-display font-bold text-cyber-pink">{{ stats.total_duration_min }}</div>
            <div class="text-xs text-gray-400 mt-1">Minutes totales</div>
        </div>
        <div class="glow-card rounded-xl p-4 text-center">
            <div class="text-3xl font-display font-bold text-cyber-cyan">{{ stats.avg_players }}</div>
            <div class="text-xs text-gray-400 mt-1">Joueurs moyens</div>
        </div>
        <div class="glow-card rounded-xl p-4 text-center">
            <div class="text-3xl font-display font-bold text-white">{{ composition.spec_counts|length }}</div>
            <div class="text-xs text-gray-400 mt-1">Specs jou√©es</div>
        </div>
    </div>
    
    <!-- Squad Composition Summary (like Quick Analysis) -->
    {% if composition %}
    <div class="glow-card rounded-2xl p-6">
        <h3 class="font-display text-xl font-bold text-green-400 mb-4">üìä R√©sum√© de Composition (Agr√©g√©)</h3>
        
        <!-- Role Distribution with specs aligned below -->
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
            <!-- DPS -->
            <div class="bg-gw2-darker rounded-xl p-4 border border-orange-500/30">
                <div class="text-center mb-3">
                    <div class="text-3xl font-bold text-orange-400">{{ composition.role_counts.dps }}</div>
                    <div class="text-sm text-gray-400">‚öîÔ∏è DPS</div>
                </div>
                <div class="space-y-1">
                    {% for spec, count in composition.specs_by_role.dps.items() %}
                    <div class="flex justify-between text-xs">
                        <span class="prof-{{ spec|lower|replace(' ', '') }}">{{ spec }}</span>
                        <span class="text-gray-400">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <!-- Strip -->
            <div class="bg-gw2-darker rounded-xl p-4 border border-purple-500/30">
                <div class="text-center mb-3">
                    <div class="text-3xl font-bold text-purple-400">{{ composition.role_counts.dps_strip|default(0) }}</div>
                    <div class="text-sm text-gray-400">üíÄ Strip</div>
                </div>
                <div class="space-y-1">
                    {% for spec, count in composition.specs_by_role.dps_strip.items() %}
                    <div class="flex justify-between text-xs">
                        <span class="prof-{{ spec|lower|replace(' ', '') }}">{{ spec }}</span>
                        <span class="text-gray-400">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <!-- Stab -->
            <div class="bg-gw2-darker rounded-xl p-4 border border-yellow-500/30">
                <div class="text-center mb-3">
                    <div class="text-3xl font-bold text-yellow-400">{{ composition.role_counts.stab }}</div>
                    <div class="text-sm text-gray-400">üõ°Ô∏è Stab</div>
                </div>
                <div class="space-y-1">
                    {% for spec, count in composition.specs_by_role.stab.items() %}
                    <div class="flex justify-between text-xs">
                        <span class="prof-{{ spec|lower|replace(' ', '') }}">{{ spec }}</span>
                        <span class="text-gray-400">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <!-- Healers -->
            <div class="bg-gw2-darker rounded-xl p-4 border border-green-500/30">
                <div class="text-center mb-3">
                    <div class="text-3xl font-bold text-green-400">{{ composition.role_counts.healer }}</div>
                    <div class="text-sm text-gray-400">üíö Healers</div>
                </div>
                <div class="space-y-1">
                    {% for spec, count in composition.specs_by_role.healer.items() %}
                    <div class="flex justify-between text-xs">
                        <span class="prof-{{ spec|lower|replace(' ', '') }}">{{ spec }}</span>
                        <span class="text-gray-400">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <!-- Boons -->
            <div class="bg-gw2-darker rounded-xl p-4 border border-cyan-500/30">
                <div class="text-center mb-3">
                    <div class="text-3xl font-bold text-cyan-400">{{ composition.role_counts.boon }}</div>
                    <div class="text-sm text-gray-400">‚ú® Boons</div>
                </div>
                <div class="space-y-1">
                    {% for spec, count in composition.specs_by_role.boon.items() %}
                    <div class="flex justify-between text-xs">
                        <span class="prof-{{ spec|lower|replace(' ', '') }}">{{ spec }}</span>
                        <span class="text-gray-400">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Fight List -->
    <div class="glow-card rounded-2xl p-6">
        <h3 class="font-display text-xl font-bold text-white mb-4">‚öîÔ∏è D√©tail des Combats</h3>
        
        <div class="overflow-x-auto">
            <table class="w-full text-sm">
                <thead>
                    <tr class="text-left text-gray-400 border-b border-gray-700">
                        <th class="pb-3 pr-4">Fichier</th>
                        <th class="pb-3 pr-4">Combat</th>
                        <th class="pb-3 pr-4">R√©sultat</th>
                        <th class="pb-3 pr-4">Dur√©e</th>
                        <th class="pb-3 pr-4">Alli√©s</th>
                        <th class="pb-3 pr-4">Stats</th>
                        <th class="pb-3">Lien</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-800">
                    {% for fight in fights %}
                    <tr class="hover:bg-gw2-darker/50">
                        <td class="py-3 pr-4 text-gray-300">{{ fight.filename[:25] }}{% if fight.filename|length > 25 %}...{% endif %}</td>
                        <td class="py-3 pr-4 text-gw2-purple font-medium">{{ fight.fight_name[:30] }}{% if fight.fight_name|length > 30 %}...{% endif %}</td>
                        <td class="py-3 pr-4">
                            {% if fight.fight_outcome == 'victory' %}
                            <span class="text-green-400">üèÜ Victoire</span>
                            {% elif fight.fight_outcome == 'defeat' %}
                            <span class="text-red-400">üíÄ D√©faite</span>
                            {% elif fight.fight_outcome == 'draw' %}
                            <span class="text-yellow-400">‚öîÔ∏è Nul</span>
                            {% else %}
                            <span class="text-gray-400">‚ùì</span>
                            {% endif %}
                        </td>
                        <td class="py-3 pr-4 text-white">
                            {% if fight.duration_sec >= 60 %}
                                {{ (fight.duration_sec // 60)|int }}m {{ (fight.duration_sec % 60)|int }}s
                            {% else %}
                                {{ fight.duration_sec|int }}s
                            {% endif %}
                        </td>
                        <td class="py-3 pr-4 text-cyber-pink">{{ fight.allies_count }}</td>
                        <td class="py-3 pr-4 text-xs text-gray-400">
                            {{ fight.fight_stats.ally_deaths|default(0) }} morts ‚Ä¢ {{ fight.fight_stats.ally_downs|default(0) }} downs
                        </td>
                        <td class="py-3">
                            <a href="{{ fight.permalink }}" target="_blank" class="text-cyber-cyan hover:underline">
                                dps.report ‚Üí
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        {% if fights|length == 0 %}
        <div class="text-center py-8 text-gray-400">
            Aucun combat n'a pu √™tre analys√©. V√©rifiez que vos fichiers sont valides.
        </div>
        {% endif %}
    </div>
</div>
